---
phase: 09-subagents
plan: 03
type: execute
wave: 3
depends_on: ["09-02"]
files_modified:
  - apps/claude-code-web/client/src/components/SubagentIndicator.tsx
  - apps/claude-code-web/client/src/components/SubagentIndicator.module.css
  - apps/claude-code-web/client/src/components/ChatView.tsx
  - apps/claude-code-web/client/src/components/ChatView.module.css
autonomous: false

must_haves:
  truths:
    - "User sees when a delegated task starts and completes"
    - "User sees what type of subagent is working on their behalf"
    - "User sees how long a subagent has been running"
    - "User can continue typing in main chat while subagent runs in background"
  artifacts:
    - path: "apps/claude-code-web/client/src/components/SubagentIndicator.tsx"
      provides: "Visual component for subagent status"
      exports: ["SubagentIndicator"]
    - path: "apps/claude-code-web/client/src/components/ChatView.tsx"
      provides: "Integration of subagent display"
      contains: "SubagentIndicator"
  key_links:
    - from: "ChatView.tsx"
      to: "useConversation"
      via: "activeSubagents state"
      pattern: "activeSubagents"
    - from: "SubagentIndicator.tsx"
      to: "SubagentState"
      via: "props.subagent"
      pattern: "SubagentState"
---

<objective>
Display subagent activity in the chat UI with progress tracking.

Purpose: Users can see when Claude spawns subagents, what type they are, how long they've been running, and when they complete.

Output:
- SubagentIndicator component showing subagent type, status, and elapsed time
- ChatView integration displaying active subagents
- Visual distinction between running and completed subagents
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-subagents/09-RESEARCH.md
@apps/claude-code-web/client/src/components/ChatView.tsx
@apps/claude-code-web/client/src/components/ThinkingIndicator (for animation pattern reference)
@apps/claude-code-web/client/src/hooks/useConversation.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SubagentIndicator component</name>
  <files>
    apps/claude-code-web/client/src/components/SubagentIndicator.tsx
    apps/claude-code-web/client/src/components/SubagentIndicator.module.css
  </files>
  <action>
    1. Create SubagentIndicator.tsx:
       ```typescript
       import { useState, useEffect } from 'react';
       import type { SubagentState } from '../types/agent';
       import styles from './SubagentIndicator.module.css';

       export interface SubagentIndicatorProps {
         subagent: SubagentState;
         isExpanded?: boolean;
         onToggle?: () => void;
       }

       export function SubagentIndicator({ subagent, isExpanded, onToggle }: SubagentIndicatorProps) {
         const [elapsedMs, setElapsedMs] = useState(0);

         // Update elapsed time every second while running
         useEffect(() => {
           if (subagent.status !== 'running') return;

           const interval = setInterval(() => {
             setElapsedMs(Date.now() - subagent.startTime);
           }, 1000);

           return () => clearInterval(interval);
         }, [subagent.status, subagent.startTime]);

         const elapsedSec = Math.floor(elapsedMs / 1000);
         const formatTime = (sec: number) => {
           if (sec < 60) return `${sec}s`;
           const min = Math.floor(sec / 60);
           const remainingSec = sec % 60;
           return `${min}m ${remainingSec}s`;
         };

         // Format agent type for display
         const displayType = subagent.type
           .replace(/-/g, ' ')
           .replace(/\b\w/g, c => c.toUpperCase());

         return (
           <div
             className={`${styles.container} ${subagent.status === 'complete' ? styles.complete : ''}`}
             onClick={onToggle}
             role={onToggle ? 'button' : undefined}
             tabIndex={onToggle ? 0 : undefined}
           >
             <div className={styles.indicator}>
               {subagent.status === 'running' ? (
                 <span className={styles.spinner} aria-label="Subagent running" />
               ) : subagent.status === 'complete' ? (
                 <span className={styles.checkmark} aria-label="Subagent complete">&#10003;</span>
               ) : (
                 <span className={styles.error} aria-label="Subagent error">&#10007;</span>
               )}
             </div>
             <div className={styles.content}>
               <span className={styles.type}>{displayType}</span>
               <span className={styles.elapsed}>
                 {subagent.status === 'running' ? formatTime(elapsedSec) : formatTime(Math.floor((subagent.endTime! - subagent.startTime) / 1000))}
               </span>
             </div>
             {onToggle && (
               <span className={styles.chevron}>{isExpanded ? '\u25BC' : '\u25B6'}</span>
             )}
           </div>
         );
       }
       ```

    2. Create SubagentIndicator.module.css:
       ```css
       .container {
         display: flex;
         align-items: center;
         gap: var(--spacing-small10, 8px);
         padding: var(--spacing-small10, 8px) var(--spacing, 16px);
         background-color: var(--color-panel-backgroundSoft, rgba(0, 0, 0, 0.03));
         border-radius: var(--radius-button, 6px);
         font-size: var(--font-size-small10, 12px);
         color: var(--color-body-text, #1a1a1a);
         transition: background-color var(--duration-normal, 200ms);
       }

       .container.complete {
         background-color: var(--color-success-backgroundSoft, rgba(0, 128, 0, 0.05));
       }

       .container[role="button"] {
         cursor: pointer;
       }

       .container[role="button"]:hover {
         background-color: var(--color-panel-backgroundHard, rgba(0, 0, 0, 0.06));
       }

       .indicator {
         display: flex;
         align-items: center;
         justify-content: center;
         width: 16px;
         height: 16px;
       }

       .spinner {
         width: 14px;
         height: 14px;
         border: 2px solid var(--color-border, #e0e0e0);
         border-top-color: var(--color-primary, #6366f1);
         border-radius: 50%;
         animation: spin 1s linear infinite;
       }

       @keyframes spin {
         to { transform: rotate(360deg); }
       }

       .checkmark {
         color: var(--color-success, #22c55e);
         font-weight: bold;
       }

       .error {
         color: var(--color-error, #ef4444);
         font-weight: bold;
       }

       .content {
         display: flex;
         align-items: center;
         gap: var(--spacing-small10, 8px);
         flex: 1;
       }

       .type {
         font-weight: var(--font-weight-medium, 500);
       }

       .elapsed {
         color: var(--color-body-textSoft20, #666);
       }

       .chevron {
         font-size: 10px;
         color: var(--color-body-textSoft20, #666);
       }
       ```
  </action>
  <verify>
    TypeScript compiles without errors:
    ```bash
    cd apps/claude-code-web/client && npx tsc --noEmit
    ```
  </verify>
  <done>
    - SubagentIndicator component created with spinner/checkmark states
    - CSS module with design token usage
    - Elapsed time updates live while subagent is running
    - Accessible with proper ARIA labels
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate subagent display into ChatView</name>
  <files>
    apps/claude-code-web/client/src/hooks/useConversation.ts
    apps/claude-code-web/client/src/components/ChatView.tsx
    apps/claude-code-web/client/src/components/ChatView.module.css
  </files>
  <action>
    1. Update useConversation.ts to expose activeSubagents:
       - Import SubagentState type
       - Get activeSubagents from useAgentStream
       - Include in returned object

    2. Update ChatView.tsx:
       - Import SubagentIndicator component
       - Get activeSubagents from useConversation
       - Render active subagents section below thinking indicator area:
         ```tsx
         {activeSubagents.size > 0 && (
           <div className={styles.subagentsArea}>
             {Array.from(activeSubagents.values())
               .filter(s => s.status === 'running')
               .map(subagent => (
                 <SubagentIndicator
                   key={subagent.id}
                   subagent={subagent}
                 />
               ))}
           </div>
         )}
         ```

    3. Add styles to ChatView.module.css:
       ```css
       .subagentsArea {
         display: flex;
         flex-direction: column;
         gap: var(--spacing-small10, 8px);
         padding: var(--spacing-small10, 8px) var(--spacing, 16px);
       }
       ```

    4. Consider where completed subagents should display:
       - Option A: Filter to show only running subagents (simpler)
       - Option B: Show all with different styling (more complex)
       - Implement Option A for now, can enhance later
  </action>
  <verify>
    TypeScript compiles without errors:
    ```bash
    cd apps/claude-code-web/client && npx tsc --noEmit
    ```
  </verify>
  <done>
    - useConversation exposes activeSubagents
    - ChatView imports and renders SubagentIndicator
    - Running subagents display below thinking area
    - CSS styles added for subagents area
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Subagent visualization in chat UI:
    - SubagentIndicator component with spinner/checkmark states
    - Elapsed time counter
    - Integration in ChatView
    - Background execution without blocking main chat (AGENT-06)
  </what-built>
  <how-to-verify>
    1. Start the dev server: `cd apps/claude-code-web && pnpm dev`
    2. Open http://localhost:5174
    3. Test subagent display (requires SDK Task tool invocation):
       - If SDK is available, ask Claude to delegate a task
       - Example prompt: "Use a subagent to explore the project structure"
       - Observe SubagentIndicator appears with spinner
       - Observe elapsed time counting up
       - When complete, spinner should change to checkmark

    4. **CRITICAL: Test main chat responsiveness (AGENT-06)**:
       - While a subagent spinner is visible and running:
         a. Click into the main chat input field
         b. Type a message (e.g., "This is a test while subagent runs")
         c. Verify the input field accepts keystrokes without lag or blocking
         d. Verify the UI remains responsive (scroll, click other elements)
       - This confirms subagents run in background without blocking main chat

    Note: If SDK is in mock mode, subagent events won't fire. Visual verification
    can also be done by temporarily adding a test subagent to activeSubagents
    in useAgentStream for development purposes.

    Alternative visual test (add to ChatView temporarily):
    ```tsx
    // Temporary test - remove after verification
    const testSubagent = {
      id: 'test-1',
      toolUseId: null,
      type: 'code-reviewer',
      status: 'running' as const,
      startTime: Date.now() - 5000,
    };
    ```
  </how-to-verify>
  <resume-signal>Type "approved" or describe any visual issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compiles: `cd apps/claude-code-web/client && npx tsc --noEmit`
2. Dev server starts: `cd apps/claude-code-web && pnpm dev`
3. SubagentIndicator component renders with correct styling
4. Running subagents show spinner with elapsed time
5. Completed subagents show checkmark
6. Main chat input remains responsive while subagent runs (AGENT-06)
</verification>

<success_criteria>
- SubagentIndicator component displays subagent type and status
- Spinner animation for running, checkmark for complete
- Elapsed time updates every second while running
- ChatView renders active subagents
- Design tokens used throughout (no hardcoded colors)
- Main chat remains responsive during subagent execution (AGENT-06)
- Human verification confirms visual quality and non-blocking behavior
</success_criteria>

<output>
After completion, create `.planning/phases/09-subagents/09-03-SUMMARY.md`
</output>
