---
phase: 08-commands-skills
plan: 04
type: execute
wave: 3
depends_on: ["08-02", "08-03"]
files_modified:
  - apps/claude-code-web/client/src/hooks/useSlashCommands.ts
  - apps/claude-code-web/client/src/components/ChatView.tsx
autonomous: true

must_haves:
  truths:
    - "Custom commands execute and send processed content as user message"
    - "/model command shows current model and allows switching"
    - "/status command shows context usage and mode"
    - "/config shows configuration info"
    - "/cost shows token usage breakdown"
  artifacts:
    - path: "apps/claude-code-web/client/src/hooks/useSlashCommands.ts"
      provides: "Full command execution with custom command support"
      exports: ["useSlashCommands"]
  key_links:
    - from: "apps/claude-code-web/client/src/hooks/useSlashCommands.ts"
      to: "/api/commands/execute"
      via: "fetch POST for custom commands"
      pattern: "fetch.*commands/execute"
---

<objective>
Complete command execution by implementing custom command execution (calling server to process and then sending as message) and adding more built-in commands (/model, /status, /config, /cost).

Purpose: Provide full Claude Code CLI parity for commonly used slash commands and enable custom command execution.

Output: Working custom command execution and expanded built-in command set.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/08-commands-skills/08-RESEARCH.md
@.planning/phases/08-commands-skills/08-02-SUMMARY.md
@.planning/phases/08-commands-skills/08-03-SUMMARY.md
@apps/claude-code-web/client/src/hooks/useSlashCommands.ts
@apps/claude-code-web/client/src/components/ChatView.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add more built-in commands</name>
  <files>apps/claude-code-web/client/src/hooks/useSlashCommands.ts</files>
  <action>
Expand built-in commands in useSlashCommands hook.

Import additional icons: GearIcon, DollarIcon (or CreditCardIcon), ChartBarIcon from @ui-kit/icons.

Add to BUILTIN_COMMANDS:
- /model: description "View or change the AI model", icon GearIcon, usage "/model [name]"
- /status: description "Show session status and context usage", icon ChartBarIcon
- /config: description "Show configuration info", icon GearIcon
- /cost: description "Show token usage and cost estimate", icon DollarIcon

Update UseSlashCommandsOptions interface to add:
- sessionId?: string | null
- modelInfo?: { id: string; name: string }

Update handleCommand to handle new commands:

/model [name]:
- If no arg: Show current model info from modelInfo prop
- If arg: For now, show "Model switching not yet supported" (model switching requires server integration)

/status:
- Show context usage (inputTokens, outputTokens, cacheReadTokens if present)
- Show current permission mode
- Show session ID
- Format as markdown

/config:
- Show current working directory (or "not set")
- Show permission mode
- Show any loaded custom commands count

/cost:
- Show token usage breakdown
- Calculate rough cost estimate (input: $3/MTok, output: $15/MTok for Claude 3.5 Sonnet)
- Format nicely with actual numbers
  </action>
  <verify>TypeScript compiles: `cd apps/claude-code-web/client && pnpm build`</verify>
  <done>Built-in commands /model, /status, /config, /cost are available</done>
</task>

<task type="auto">
  <name>Task 2: Implement custom command execution</name>
  <files>apps/claude-code-web/client/src/hooks/useSlashCommands.ts</files>
  <action>
Add custom command execution to handleCommand in useSlashCommands.

Update UseSlashCommandsOptions to add:
- sendMessage: (prompt: string) => void (for sending processed command as user message)
- cwd?: string (working directory for command execution)

In handleCommand, for commands not in BUILTIN_COMMANDS:
1. Check if command exists in customCommands
2. If not, return { handled: false, message: `Unknown command: /${command}` }
3. If exists, call server to process:
   ```typescript
   const response = await fetch(`${API_URL}/api/commands/execute`, {
     method: 'POST',
     headers: { 'Content-Type': 'application/json' },
     body: JSON.stringify({ command, args, cwd }),
   });
   ```
4. If response ok, get processed content and call sendMessage(content)
5. Return { handled: true, clearInput: true }
6. On error, show error message via addSystemMessage

Note: handleCommand needs to be async, but SlashCommandResult is sync. Handle this by:
- Returning { handled: true, clearInput: true } immediately for custom commands
- Executing the async work in background (fire and forget with error handling)

Alternative pattern: Return promise from handleCommand (check if react-chat supports this).
Actually, the onCommand callback in ChatInput can return void, so fire-and-forget is acceptable.
  </action>
  <verify>TypeScript compiles: `cd apps/claude-code-web/client && pnpm build`</verify>
  <done>Custom commands execute by calling server and sending processed content as message</done>
</task>

<task type="auto">
  <name>Task 3: Wire additional props to useSlashCommands in ChatView</name>
  <files>apps/claude-code-web/client/src/components/ChatView.tsx</files>
  <action>
Update ChatView to pass all required props to useSlashCommands.

Update the useSlashCommands call to include:
```typescript
const { commands, handleCommand } = useSlashCommands({
  clearConversation,
  addSystemMessage,
  sendMessage,
  contextUsage,
  permissionMode,
  sessionId,
  // modelInfo: { id: 'claude-sonnet-4-5-20250929', name: 'Claude 3.5 Sonnet' }, // hardcoded for now
});
```

Ensure sendMessage from useConversation is passed through.

The cwd can be derived from environment or session state. For now, use a reasonable default like process.cwd() equivalent (may need to come from server or be hardcoded to '/').

Test each built-in command:
- /help shows all commands
- /clear clears conversation
- /model shows current model
- /status shows context and mode
- /config shows config info
- /cost shows token breakdown
  </action>
  <verify>
Build passes: `cd apps/claude-code-web && pnpm build`
Manual test: /status, /config, /cost commands work
Manual test: Custom command (if any exist) executes and sends content
  </verify>
  <done>All built-in commands work, custom commands execute through server</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. /model shows current model info
3. /status shows context usage and permission mode
4. /config shows configuration information
5. /cost shows token usage with cost estimate
6. Custom commands call server and send processed content as message
</verification>

<success_criteria>
- /model, /status, /config, /cost built-in commands work
- Custom commands execute via server processing
- Processed command content is sent as user message to Claude
- Unknown commands show error message
- All commands clear input after execution
</success_criteria>

<output>
After completion, create `.planning/phases/08-commands-skills/08-04-SUMMARY.md`
</output>
