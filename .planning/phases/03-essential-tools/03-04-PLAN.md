---
phase: 03-essential-tools
plan: 04
type: execute
wave: 3
depends_on: ["03-01", "03-02"]
files_modified:
  - apps/claude-code-web/client/src/components/FileBrowser.tsx
  - apps/claude-code-web/client/src/components/FileBrowser.module.css
  - apps/claude-code-web/client/src/components/FileViewer.tsx
  - apps/claude-code-web/client/src/components/FileViewer.module.css
  - apps/claude-code-web/client/src/hooks/useFileContent.ts
  - apps/claude-code-web/client/src/utils/fileIcons.tsx
autonomous: false
user_setup: []

must_haves:
  truths:
    - "User can browse workspace files in a tree view"
    - "Clicking a file opens it in a viewer with syntax highlighting"
    - "Directory expansion loads children lazily from server"
    - "File viewer panel can be closed"
  artifacts:
    - path: "apps/claude-code-web/client/src/components/FileBrowser.tsx"
      provides: "TreeView-based file browser component"
      exports: ["FileBrowser"]
    - path: "apps/claude-code-web/client/src/components/FileViewer.tsx"
      provides: "File content viewer modal/panel"
      exports: ["FileViewer"]
    - path: "apps/claude-code-web/client/src/hooks/useFileContent.ts"
      provides: "Hook for fetching file content from server"
      exports: ["useFileContent"]
  key_links:
    - from: "apps/claude-code-web/client/src/components/FileBrowser.tsx"
      to: "@ui-kit/react"
      via: "TreeView component import"
      pattern: "import.*TreeView.*@ui-kit/react"
    - from: "apps/claude-code-web/client/src/hooks/useFileContent.ts"
      to: "/api/files/read"
      via: "fetch call"
      pattern: "fetch.*api/files/read"
    - from: "apps/claude-code-web/client/src/components/FileViewer.tsx"
      to: "@ui-kit/react-markdown"
      via: "CodeBlock for content display"
      pattern: "import.*CodeBlock"
---

<objective>
Create file browser and viewer components for workspace exploration.

Purpose: Users need to browse the workspace file system and view file contents. This supports the "clickable file paths" requirement - when a user clicks a file path in tool results, it opens in the viewer.

Output: FileBrowser component using TreeView for navigation, FileViewer for displaying file contents, and useFileContent hook for data fetching.

Note: Layout integration (sidebar panel positioning, split-pane layouts) is explicitly deferred to Phase 6 polish pass. Phase 3 creates the standalone components; Phase 6 integrates them into the main application layout.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-essential-tools/03-RESEARCH.md

# Dependencies
@.planning/phases/03-essential-tools/03-01-SUMMARY.md
@.planning/phases/03-essential-tools/03-02-SUMMARY.md

# UI-kit components
@packages/ui-kit/react/src/components/TreeView/TreeView.tsx
@packages/ui-kit/react-markdown/src/components/MarkdownRenderer/renderers/CodeBlock.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useFileContent hook and file icons utility</name>
  <files>apps/claude-code-web/client/src/hooks/useFileContent.ts, apps/claude-code-web/client/src/utils/fileIcons.tsx</files>
  <action>
1. Create useFileContent hook:

```typescript
interface FileContent {
  path: string;
  content: string;
  size: number;
  lines: number;
}

interface UseFileContentReturn {
  fileContent: FileContent | null;
  isLoading: boolean;
  error: string | null;
  loadFile: (path: string) => Promise<void>;
  clearFile: () => void;
}
```

Implementation:
- Use useState for fileContent, isLoading, error
- loadFile: fetch from `/api/files/read?path=${encodeURIComponent(path)}`
- Handle loading states and errors
- clearFile: reset to null

2. Create file icons utility:

```typescript
import type { IconResolver } from '@ui-kit/react';
// Import file icons from @ui-kit/icons (FolderIcon, FileIcon, etc.)

export const fileIconResolver: IconResolver = (type, node) => { ... }
```

Map file extensions to appropriate icons:
- Folders: FolderIcon
- .ts/.tsx/.js/.jsx: FileCodeIcon or FileIcon
- .json: FileIcon
- Default: FileIcon

Note: Check what icons are available in @ui-kit/icons. If specific file type icons don't exist, use generic FileIcon for files and FolderIcon for directories.
  </action>
  <verify>TypeScript compiles: `cd apps/claude-code-web/client && pnpm build`</verify>
  <done>useFileContent hook fetches file content, fileIconResolver provides icons for TreeView</done>
</task>

<task type="auto">
  <name>Task 2: Create FileBrowser component</name>
  <files>apps/claude-code-web/client/src/components/FileBrowser.tsx, apps/claude-code-web/client/src/components/FileBrowser.module.css</files>
  <action>
Create file browser using TreeView:

```typescript
interface FileBrowserProps {
  rootPath?: string;
  onFileSelect: (path: string) => void;
  className?: string;
}
```

Implementation:
1. Load root directory on mount using fetch to /api/files/list
2. Transform DirectoryEntry[] to TreeNode[] format:
   - id: entry path
   - label: entry name
   - type: entry.type
   - children: undefined initially for directories (lazy load)

3. Handle node expansion:
   - On expand, if node is directory and has no children loaded, fetch /api/files/list?path=nodePath
   - Update tree data with fetched children

4. Handle selection:
   - When file is selected (not directory), call onFileSelect with path

Use TreeView from @ui-kit/react with:
- selectable={true}
- onSelect callback
- onNodeExpand for lazy loading
- iconResolver={fileIconResolver}

CSS module:
- .fileBrowser - container styling
- Consider fixed height with scroll
  </action>
  <verify>TypeScript compiles: `cd apps/claude-code-web/client && pnpm build`</verify>
  <done>FileBrowser displays workspace files in TreeView with lazy directory loading</done>
</task>

<task type="auto">
  <name>Task 3: Create FileViewer component</name>
  <files>apps/claude-code-web/client/src/components/FileViewer.tsx, apps/claude-code-web/client/src/components/FileViewer.module.css</files>
  <action>
Create file viewer panel/modal:

```typescript
interface FileViewerProps {
  filePath: string | null;
  onClose: () => void;
}
```

Implementation:
1. Use useFileContent hook to load file when filePath changes
2. Show loading state while fetching
3. Show error state if fetch fails
4. Display file content using CodeBlock from @ui-kit/react-markdown

Structure:
- Header with file path and close button (X icon from @ui-kit/icons)
- Content area with CodeBlock:
  - code={fileContent.content}
  - language={detectLanguage(filePath)}
  - showLineNumbers={true}
  - maxHeight based on viewport

If filePath is null, render nothing (or empty placeholder).

CSS module:
- .fileViewer - panel/modal container with backdrop
- .fileViewerHeader - sticky header with path and close button
- .fileViewerContent - scrollable content area
- .loadingState, .errorState - state displays
  </action>
  <verify>TypeScript compiles: `cd apps/claude-code-web/client && pnpm build`</verify>
  <done>FileViewer displays file content with syntax highlighting and close capability</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>File browser and viewer components for workspace exploration (standalone, not yet integrated into main layout)</what-built>
  <how-to-verify>
1. Start the dev server: `pnpm dev:v2` (or `cd apps/claude-code-web && pnpm dev`)
2. Navigate to the app in browser
3. Note: FileBrowser and FileViewer are standalone components not yet wired into the main UI layout
4. To verify the components work:
   - Import and render FileBrowser in a test location (e.g., temporarily in App.tsx or a test route)
   - Verify TreeView shows directory structure
   - Click on directories to expand (should lazy load)
   - Click on files to trigger onFileSelect
   - Verify FileViewer displays content with syntax highlighting when a file is selected
5. Verify file icons render correctly for folders and files
6. Verify close button on FileViewer works

**Out of scope for Phase 3:**
- Sidebar panel integration (deferred to Phase 6)
- Split-pane layout with chat (deferred to Phase 6)
- Persistent file browser state (deferred to Phase 6)

The goal of this checkpoint is to confirm the components function correctly in isolation. Layout integration happens in Phase 6 polish pass.
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
1. Client builds without TypeScript errors
2. useFileContent hook successfully fetches file content from server
3. FileBrowser displays directory tree with lazy loading
4. FileViewer shows file content with syntax highlighting
5. File icons render appropriately for different file types
</verification>

<success_criteria>
- FileBrowser renders workspace files using TreeView
- Directory expansion lazily loads children from server
- File selection triggers onFileSelect callback
- FileViewer displays file content with CodeBlock syntax highlighting
- FileViewer can be closed
- UI feedback for loading and error states
- Components verified working in isolation (layout integration deferred to Phase 6)
</success_criteria>

<output>
After completion, create `.planning/phases/03-essential-tools/03-04-SUMMARY.md`
</output>
