---
phase: 03-essential-tools
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - apps/claude-code-web/client/src/components/ToolResultDisplay.tsx
  - apps/claude-code-web/client/src/components/FileContentResult.tsx
  - apps/claude-code-web/client/src/components/ToolResultDisplay.module.css
  - apps/claude-code-web/client/src/components/FileContentResult.module.css
autonomous: true

must_haves:
  truths:
    - "Read tool output displays file content with syntax highlighting"
    - "File path shown as clickable header with line count"
    - "Content collapsible for large files"
    - "Tool result router dispatches to correct renderer by tool name"
  artifacts:
    - path: "apps/claude-code-web/client/src/components/ToolResultDisplay.tsx"
      provides: "Router component for tool result visualization"
      exports: ["ToolResultDisplay"]
    - path: "apps/claude-code-web/client/src/components/FileContentResult.tsx"
      provides: "Read tool result visualization with CodeBlock"
      exports: ["FileContentResult"]
  key_links:
    - from: "apps/claude-code-web/client/src/components/ToolResultDisplay.tsx"
      to: "apps/claude-code-web/client/src/components/FileContentResult.tsx"
      via: "Dynamic import based on tool name"
      pattern: "case 'Read'"
    - from: "apps/claude-code-web/client/src/components/FileContentResult.tsx"
      to: "@ui-kit/react-markdown"
      via: "CodeBlock import"
      pattern: "import.*CodeBlock"
---

<objective>
Create the Read tool visualization component with syntax highlighting.

Purpose: When Claude executes the Read tool, users should see file contents displayed with proper syntax highlighting, line numbers, and collapse/expand capability for large files.

Output: ToolResultDisplay router component that dispatches to tool-specific renderers, plus FileContentResult component that displays Read tool output using CodeBlock from react-markdown.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-essential-tools/03-RESEARCH.md

# Dependencies
@.planning/phases/03-essential-tools/03-01-SUMMARY.md

# UI-kit components
@packages/ui-kit/react-markdown/src/components/MarkdownRenderer/renderers/CodeBlock.tsx

# Existing patterns
@apps/claude-code-web/client/src/components/ChatView.tsx
@apps/claude-code-web/client/src/utils/messageTransformer.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ToolResultDisplay router component</name>
  <files>apps/claude-code-web/client/src/components/ToolResultDisplay.tsx, apps/claude-code-web/client/src/components/ToolResultDisplay.module.css</files>
  <action>
Create a router component that renders appropriate UI based on tool name:

```typescript
interface ToolResultDisplayProps {
  toolName: string;
  input: Record<string, unknown>;
  output: string;
  isExpanded: boolean;
  onToggleExpand: () => void;
  onFileClick?: (path: string, line?: number) => void;
}
```

Switch on toolName:
- 'Read' -> FileContentResult
- 'Glob' -> FileListResult (placeholder for now, returns DefaultToolResult)
- 'Grep' -> SearchResultsDisplay (placeholder for now, returns DefaultToolResult)
- default -> DefaultToolResult (pre block with raw output)

DefaultToolResult: Simple pre block showing raw output text, collapsible.

CSS module should define styles for:
- .toolResultContainer - wrapper
- .defaultResult - pre block styling with overflow scroll
  </action>
  <verify>TypeScript compiles: `cd apps/claude-code-web/client && pnpm build`</verify>
  <done>ToolResultDisplay component routes to appropriate renderer with fallback to DefaultToolResult</done>
</task>

<task type="auto">
  <name>Task 2: Create FileContentResult component</name>
  <files>apps/claude-code-web/client/src/components/FileContentResult.tsx, apps/claude-code-web/client/src/components/FileContentResult.module.css</files>
  <action>
Create component to display Read tool output with syntax highlighting:

```typescript
interface FileContentResultProps {
  filePath: string;
  content: string;
  isExpanded: boolean;
  onToggleExpand: () => void;
  onFileClick?: (path: string) => void;
}
```

Structure:
1. Header button showing file path (clickable) + line count + expand/collapse chevron
2. When expanded: CodeBlock from @ui-kit/react-markdown with:
   - code={content}
   - language={detectLanguage(filePath)}
   - showLineNumbers={true}
   - collapsible={lineCount > 50}
   - defaultCollapsed={lineCount > 100}
   - maxHeight={400}

Import detectLanguage from '../utils/languageDetection'.
Import ChevronDownIcon from '@ui-kit/icons/ChevronDownIcon'.

CSS module styles:
- .fileContent - container
- .fileHeader - clickable header button
- .filePath - path text styling
- .lineCount - secondary text for line count
- .chevron / .chevronExpanded - rotation animation
  </action>
  <verify>TypeScript compiles: `cd apps/claude-code-web/client && pnpm build`</verify>
  <done>FileContentResult displays file content with syntax highlighting, line numbers, and collapse for large files</done>
</task>

<task type="auto">
  <name>Task 3: Integrate ToolResultDisplay into ChatMessage tool output</name>
  <files>apps/claude-code-web/client/src/utils/messageTransformer.ts</files>
  <action>
Update the message transformer to prepare tool results for display:

1. In transformContentBlockToPart for tool_use blocks, ensure output is captured when available
2. Add a comment noting that ToolResultDisplay will be used to render tool outputs

Note: The actual integration with ChatMessage happens via the parts system already established. The ChatMessage component in ui-kit/react-chat already renders tool_calls with output. What we need is for the tool output expansion to use ToolResultDisplay instead of plain pre block.

For now, document the integration point in a comment. The ChatMessage component in ui-kit handles the tool_calls rendering - to use ToolResultDisplay, we would need to either:
a) Export a custom toolResultRenderer prop from ChatMessage (future enhancement)
b) Or wrap/extend ChatMessage in claude-code-web

Add a TODO comment in messageTransformer.ts noting this integration path for Phase 4 or later.
  </action>
  <verify>Build passes, no regressions in existing functionality</verify>
  <done>ToolResultDisplay ready for integration, integration path documented</done>
</task>

</tasks>

<verification>
1. Client builds without TypeScript errors
2. ToolResultDisplay component exports correctly
3. FileContentResult renders with CodeBlock
4. Language detection works for common file types
5. No regressions in existing chat functionality
</verification>

<success_criteria>
- ToolResultDisplay routes to FileContentResult for Read tool
- FileContentResult displays file content with syntax highlighting
- File paths shown in header with line count
- Large files (50+ lines) are collapsible
- Default tool result fallback works for unknown tools
</success_criteria>

<output>
After completion, create `.planning/phases/03-essential-tools/03-02-SUMMARY.md`
</output>
