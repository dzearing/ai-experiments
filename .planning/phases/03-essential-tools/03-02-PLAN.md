---
phase: 03-essential-tools
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - apps/claude-code-web/client/src/components/ToolResultDisplay.tsx
  - apps/claude-code-web/client/src/components/FileContentResult.tsx
  - apps/claude-code-web/client/src/components/ToolResultDisplay.module.css
  - apps/claude-code-web/client/src/components/FileContentResult.module.css
  - apps/claude-code-web/client/src/components/ToolExecutionIndicator.tsx
  - apps/claude-code-web/client/src/components/ToolExecutionIndicator.module.css
  - packages/ui-kit/react-chat/src/components/ChatPanel/ChatPanel.tsx
  - packages/ui-kit/react-chat/src/components/ChatMessage/ChatMessage.tsx
  - apps/claude-code-web/client/src/components/ChatView.tsx
autonomous: true

must_haves:
  truths:
    - "Read tool output displays file content with syntax highlighting"
    - "File path shown as clickable header with line count"
    - "Content collapsible for large files"
    - "Tool result router dispatches to correct renderer by tool name"
    - "Tool execution shows progress indicator while running"
    - "ToolResultDisplay is used when rendering tool outputs in chat"
  artifacts:
    - path: "apps/claude-code-web/client/src/components/ToolResultDisplay.tsx"
      provides: "Router component for tool result visualization"
      exports: ["ToolResultDisplay"]
    - path: "apps/claude-code-web/client/src/components/FileContentResult.tsx"
      provides: "Read tool result visualization with CodeBlock"
      exports: ["FileContentResult"]
    - path: "apps/claude-code-web/client/src/components/ToolExecutionIndicator.tsx"
      provides: "Progress indicator for running tools"
      exports: ["ToolExecutionIndicator"]
  key_links:
    - from: "apps/claude-code-web/client/src/components/ToolResultDisplay.tsx"
      to: "apps/claude-code-web/client/src/components/FileContentResult.tsx"
      via: "Dynamic import based on tool name"
      pattern: "case 'Read'"
    - from: "apps/claude-code-web/client/src/components/FileContentResult.tsx"
      to: "@ui-kit/react-markdown"
      via: "CodeBlock import"
      pattern: "import.*CodeBlock"
    - from: "apps/claude-code-web/client/src/components/ToolResultDisplay.tsx"
      to: "apps/claude-code-web/client/src/components/ToolExecutionIndicator.tsx"
      via: "Conditional render when tool is executing"
      pattern: "isExecuting.*ToolExecutionIndicator"
    - from: "apps/claude-code-web/client/src/components/ChatView.tsx"
      to: "apps/claude-code-web/client/src/components/ToolResultDisplay.tsx"
      via: "renderToolResult prop passed to ChatPanel"
      pattern: "renderToolResult.*ToolResultDisplay"
---

<objective>
Create the Read tool visualization component with syntax highlighting and integrate it into chat rendering.

Purpose: When Claude executes the Read tool, users should see file contents displayed with proper syntax highlighting, line numbers, and collapse/expand capability for large files. While any tool is executing, a progress indicator shows activity. The ToolResultDisplay must be wired into ChatView so tool outputs render with enhanced visualization.

Output: ToolResultDisplay router component that dispatches to tool-specific renderers, FileContentResult component that displays Read tool output using CodeBlock, ToolExecutionIndicator for showing tool execution progress, and integration with ChatPanel via renderToolResult prop.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-essential-tools/03-RESEARCH.md

# Dependencies
@.planning/phases/03-essential-tools/03-01-SUMMARY.md

# UI-kit components
@packages/ui-kit/react-markdown/src/components/MarkdownRenderer/renderers/CodeBlock.tsx
@packages/ui-kit/react-chat/src/components/ChatPanel/ChatPanel.tsx
@packages/ui-kit/react-chat/src/components/ChatMessage/ChatMessage.tsx

# Existing patterns
@apps/claude-code-web/client/src/components/ChatView.tsx
@apps/claude-code-web/client/src/utils/messageTransformer.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ToolExecutionIndicator and ToolResultDisplay components</name>
  <files>apps/claude-code-web/client/src/components/ToolExecutionIndicator.tsx, apps/claude-code-web/client/src/components/ToolExecutionIndicator.module.css, apps/claude-code-web/client/src/components/ToolResultDisplay.tsx, apps/claude-code-web/client/src/components/ToolResultDisplay.module.css</files>
  <action>
1. Create ToolExecutionIndicator component:

```typescript
interface ToolExecutionIndicatorProps {
  toolName: string;
  isExecuting: boolean;
}
```

Structure:
- Animated spinner or pulsing indicator (CSS animation)
- Tool name displayed next to indicator: "Running {toolName}..."
- Only renders when isExecuting is true

Use design tokens:
- --color-body-textSoft10 for the text
- --color-primary-background for the spinner accent

CSS module styles:
- .executionIndicator - container with flex layout
- .spinner - rotating or pulsing animation (use @keyframes)
- .toolName - text styling

2. Create ToolResultDisplay router component:

```typescript
interface ToolResultDisplayProps {
  toolName: string;
  input: Record<string, unknown>;
  output: string;
  isExpanded: boolean;
  isExecuting?: boolean;
  onToggleExpand: () => void;
  onFileClick?: (path: string, line?: number) => void;
}
```

Implementation:
- If isExecuting is true, render ToolExecutionIndicator
- Switch on toolName for completed tools:
  - 'Read' -> FileContentResult
  - 'Glob' -> DefaultToolResult (placeholder)
  - 'Grep' -> DefaultToolResult (placeholder)
  - default -> DefaultToolResult (pre block with raw output)

DefaultToolResult: Simple pre block showing raw output text, collapsible.

CSS module should define styles for:
- .toolResultContainer - wrapper
- .defaultResult - pre block styling with overflow scroll
  </action>
  <verify>TypeScript compiles: `cd apps/claude-code-web/client && pnpm build`</verify>
  <done>ToolExecutionIndicator displays animated progress indicator; ToolResultDisplay routes to appropriate renderer</done>
</task>

<task type="auto">
  <name>Task 2: Create FileContentResult component</name>
  <files>apps/claude-code-web/client/src/components/FileContentResult.tsx, apps/claude-code-web/client/src/components/FileContentResult.module.css</files>
  <action>
Create component to display Read tool output with syntax highlighting:

```typescript
interface FileContentResultProps {
  filePath: string;
  content: string;
  isExpanded: boolean;
  onToggleExpand: () => void;
  onFileClick?: (path: string) => void;
}
```

Structure:
1. Header button showing file path (clickable) + line count + expand/collapse chevron
2. When expanded: CodeBlock from @ui-kit/react-markdown with:
   - code={content}
   - language={detectLanguage(filePath)}
   - showLineNumbers={true}
   - collapsible={lineCount > 50}
   - defaultCollapsed={lineCount > 100}
   - maxHeight={400}

Import detectLanguage from '../utils/languageDetection'.
Import ChevronDownIcon from '@ui-kit/icons/ChevronDownIcon'.

CSS module styles:
- .fileContent - container
- .fileHeader - clickable header button
- .filePath - path text styling
- .lineCount - secondary text for line count
- .chevron / .chevronExpanded - rotation animation
  </action>
  <verify>TypeScript compiles: `cd apps/claude-code-web/client && pnpm build`</verify>
  <done>FileContentResult displays file content with syntax highlighting, line numbers, and collapse for large files</done>
</task>

<task type="auto">
  <name>Task 3: Add renderToolResult prop to ChatPanel and ChatMessage</name>
  <files>packages/ui-kit/react-chat/src/components/ChatPanel/ChatPanel.tsx, packages/ui-kit/react-chat/src/components/ChatMessage/ChatMessage.tsx</files>
  <action>
Add a renderToolResult prop to allow custom tool result rendering:

1. In ChatMessage.tsx, add prop:

```typescript
interface ChatMessageProps {
  // ... existing props
  /** Custom renderer for tool results. If not provided, uses default pre block. */
  renderToolResult?: (props: {
    toolName: string;
    input: Record<string, unknown>;
    output: string;
    isExpanded: boolean;
    onToggleExpand: () => void;
  }) => ReactNode;
}
```

2. In the tool_calls rendering section (around line 789), replace the default `<pre>` block:

```typescript
{hasOutput && isExpanded && (
  <div className={styles.toolResult}>
    {renderToolResult ? (
      renderToolResult({
        toolName: toolCall.name,
        input: toolCall.input ?? {},
        output: outputText,
        isExpanded,
        onToggleExpand: () => toggleToolExpanded(toolKey),
      })
    ) : (
      <pre className={styles.toolResultContent}>
        {outputText}
      </pre>
    )}
  </div>
)}
```

3. In ChatPanel.tsx, add the prop and pass it through to ChatMessage:

```typescript
interface ChatPanelProps {
  // ... existing props
  /** Custom renderer for tool results in messages */
  renderToolResult?: ChatMessageProps['renderToolResult'];
}
```

Pass it to ChatMessage in the render:
```typescript
<ChatMessage
  // ... existing props
  renderToolResult={renderToolResult}
/>
```

4. Export the type from the package index if needed.
  </action>
  <verify>TypeScript compiles: `cd packages/ui-kit/react-chat && pnpm build`</verify>
  <done>ChatPanel and ChatMessage accept renderToolResult prop for custom tool output rendering</done>
</task>

<task type="auto">
  <name>Task 4: Wire ToolResultDisplay into ChatView</name>
  <files>apps/claude-code-web/client/src/components/ChatView.tsx</files>
  <action>
Integrate ToolResultDisplay into ChatView by passing renderToolResult to ChatPanel:

1. Import ToolResultDisplay:
```typescript
import { ToolResultDisplay } from './ToolResultDisplay';
```

2. Create a renderToolResult callback:
```typescript
const renderToolResult = useCallback((props: {
  toolName: string;
  input: Record<string, unknown>;
  output: string;
  isExpanded: boolean;
  onToggleExpand: () => void;
}) => {
  return (
    <ToolResultDisplay
      toolName={props.toolName}
      input={props.input}
      output={props.output}
      isExpanded={props.isExpanded}
      onToggleExpand={props.onToggleExpand}
      onFileClick={(path) => {
        // TODO: Phase 4 will wire this to FileViewer
        console.log('File clicked:', path);
      }}
    />
  );
}, []);
```

3. Pass to ChatPanel:
```typescript
<ChatPanel
  messages={messages}
  // ... existing props
  renderToolResult={renderToolResult}
/>
```

This completes the integration - tool results will now render using ToolResultDisplay, which routes Read tool outputs to FileContentResult with syntax highlighting.
  </action>
  <verify>Build passes: `cd apps/claude-code-web/client && pnpm build`. Manual test: start dev server, send a message that triggers Read tool, verify output shows with syntax highlighting instead of plain pre block.</verify>
  <done>ToolResultDisplay integrated into ChatView; Read tool outputs render with syntax highlighting</done>
</task>

</tasks>

<verification>
1. Client builds without TypeScript errors
2. ui-kit/react-chat builds without TypeScript errors
3. ToolExecutionIndicator shows animated spinner with tool name
4. ToolResultDisplay component exports correctly
5. FileContentResult renders with CodeBlock
6. Language detection works for common file types
7. ChatPanel accepts and uses renderToolResult prop
8. Tool outputs in chat use ToolResultDisplay instead of plain pre block
</verification>

<success_criteria>
- ToolExecutionIndicator displays progress while tool is running (TOOL-11)
- ToolResultDisplay routes to FileContentResult for Read tool
- FileContentResult displays file content with syntax highlighting
- File paths shown in header with line count
- Large files (50+ lines) are collapsible
- Default tool result fallback works for unknown tools
- renderToolResult prop added to ChatPanel/ChatMessage in ui-kit
- ChatView passes renderToolResult to use ToolResultDisplay
</success_criteria>

<output>
After completion, create `.planning/phases/03-essential-tools/03-02-SUMMARY.md`
</output>
