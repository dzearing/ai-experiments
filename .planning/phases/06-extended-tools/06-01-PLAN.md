---
phase: 06-extended-tools
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/claude-code-web/client/package.json
  - apps/claude-code-web/client/src/utils/diffGenerator.ts
  - apps/claude-code-web/client/src/components/WriteResultDisplay.tsx
  - apps/claude-code-web/client/src/components/WriteResultDisplay.module.css
  - apps/claude-code-web/client/src/components/EditResultDisplay.tsx
  - apps/claude-code-web/client/src/components/EditResultDisplay.module.css
  - apps/claude-code-web/client/src/components/ToolResultDisplay.tsx
  - apps/claude-code-web/client/src/components/PermissionDialog.tsx
autonomous: true

must_haves:
  truths:
    - "Write tool result shows file path and operation success/failure"
    - "Edit tool result shows unified diff of changes made"
    - "Permission dialog shows diff preview for Edit tool before approval"
    - "Permission dialog shows file content preview for Write tool before approval"
  artifacts:
    - path: "apps/claude-code-web/client/src/utils/diffGenerator.ts"
      provides: "Unified diff generation from old/new strings"
      exports: ["generateUnifiedDiff", "generateInlineDiff"]
    - path: "apps/claude-code-web/client/src/components/WriteResultDisplay.tsx"
      provides: "Write tool result visualization"
      exports: ["WriteResultDisplay"]
    - path: "apps/claude-code-web/client/src/components/EditResultDisplay.tsx"
      provides: "Edit tool result with diff display"
      exports: ["EditResultDisplay"]
  key_links:
    - from: "ToolResultDisplay.tsx"
      to: "WriteResultDisplay.tsx"
      via: "switch case for 'Write' tool"
      pattern: "case 'Write'"
    - from: "ToolResultDisplay.tsx"
      to: "EditResultDisplay.tsx"
      via: "switch case for 'Edit' tool"
      pattern: "case 'Edit'"
    - from: "EditResultDisplay.tsx"
      to: "diffGenerator.ts"
      via: "import generateInlineDiff"
      pattern: "import.*diffGenerator"
    - from: "PermissionDialog.tsx"
      to: "FileDiff component"
      via: "diff preview in Edit tool case"
      pattern: "FileDiff"
---

<objective>
Write and Edit tool visualization with diff preview

Purpose: Users need to see what Write tool created and what Edit tool changed. For permission approval, users should see a preview of changes before approving. This enables informed consent for file modifications.

Output: WriteResultDisplay and EditResultDisplay components integrated into ToolResultDisplay router, plus enhanced permission dialog with diff preview for Edit tool.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-extended-tools/06-RESEARCH.md

@apps/claude-code-web/client/src/components/ToolResultDisplay.tsx
@apps/claude-code-web/client/src/components/PermissionDialog.tsx
@apps/claude-code-web/client/src/components/FileContentResult.tsx
@packages/ui-kit/react/src/components/FileDiff/FileDiff.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add diff library and create diffGenerator utility</name>
  <files>
    apps/claude-code-web/client/package.json
    apps/claude-code-web/client/src/utils/diffGenerator.ts
  </files>
  <action>
1. Add the `diff` package to client dependencies:
   ```bash
   cd apps/claude-code-web/client && pnpm add diff && pnpm add -D @types/diff
   ```

2. Create `apps/claude-code-web/client/src/utils/diffGenerator.ts`:
   - Import `createPatch` from 'diff'
   - Export `generateUnifiedDiff(filePath: string, oldContent: string, newContent: string): string`
     - Uses createPatch with 3 lines of context
     - Returns unified diff format string
   - Export `generateInlineDiff(oldString: string, newString: string): string`
     - For Edit tool with just old_string/new_string (no full file context)
     - Uses createPatch with 'changes' as filename

The diff library handles Unicode, multi-line, and edge cases correctly.
  </action>
  <verify>
    - `pnpm ls diff` shows diff package installed
    - File exists at apps/claude-code-web/client/src/utils/diffGenerator.ts
    - TypeScript compiles without errors: `cd apps/claude-code-web/client && pnpm tsc --noEmit`
  </verify>
  <done>
    diffGenerator.ts exports generateUnifiedDiff and generateInlineDiff functions that produce valid unified diff strings
  </done>
</task>

<task type="auto">
  <name>Task 2: Create WriteResultDisplay and EditResultDisplay components</name>
  <files>
    apps/claude-code-web/client/src/components/WriteResultDisplay.tsx
    apps/claude-code-web/client/src/components/WriteResultDisplay.module.css
    apps/claude-code-web/client/src/components/EditResultDisplay.tsx
    apps/claude-code-web/client/src/components/EditResultDisplay.module.css
    apps/claude-code-web/client/src/components/ToolResultDisplay.tsx
  </files>
  <action>
1. Create WriteResultDisplay.tsx:
   - Props: `{ filePath: string; content?: string; isExpanded: boolean; onToggleExpand: () => void; onFileClick?: (path: string) => void }`
   - Display file path as ClickablePath
   - Show success indicator (checkmark icon or "File created" text)
   - When expanded, show content preview with syntax highlighting using FileContentResult pattern
   - Use CSS module for styling

2. Create WriteResultDisplay.module.css:
   - Style the result container with success indicator
   - Use design tokens (--color-success-*, --spacing-*)

3. Create EditResultDisplay.tsx:
   - Props: `{ filePath: string; oldString: string; newString: string; replaceAll?: boolean; isExpanded: boolean; onToggleExpand: () => void; onFileClick?: (path: string) => void }`
   - Display file path as ClickablePath
   - Show change summary (e.g., "1 occurrence replaced")
   - When expanded, use FileDiff component from @ui-kit/react to show the diff
   - Use generateInlineDiff from diffGenerator.ts to create diff string
   - FileDiff props: path={filePath}, changeType="modified", diff={diffString}

4. Create EditResultDisplay.module.css:
   - Style the result container
   - Use design tokens

5. Update ToolResultDisplay.tsx:
   - Import WriteResultDisplay and EditResultDisplay
   - Add case 'Write': extract file_path, content from input, render WriteResultDisplay
   - Add case 'Edit': extract file_path, old_string, new_string, replace_all from input, render EditResultDisplay
  </action>
  <verify>
    - Files exist at specified paths
    - TypeScript compiles: `cd apps/claude-code-web/client && pnpm tsc --noEmit`
    - No lint errors: `cd apps/claude-code-web/client && pnpm lint`
  </verify>
  <done>
    Write and Edit tools render semantic results in ToolResultDisplay: Write shows file path and content preview, Edit shows file path and inline diff using FileDiff component
  </done>
</task>

<task type="auto">
  <name>Task 3: Enhance PermissionDialog with diff preview for Edit tool</name>
  <files>
    apps/claude-code-web/client/src/components/PermissionDialog.tsx
    apps/claude-code-web/client/src/components/PermissionDialog.module.css
  </files>
  <action>
1. Update PermissionDialog.tsx:
   - Import FileDiff from @ui-kit/react
   - Import generateInlineDiff from utils/diffGenerator
   - Change formatToolInput to return ReactNode instead of string (or create separate preview component)
   - For 'Edit' case: render FileDiff component with generated diff instead of plain text
     - Use generateInlineDiff(oldString, newString) to create diff
     - FileDiff props: path={filePath}, changeType="modified", diff={diffString}, compact={true}, maxHeight="300px"
   - For 'Write' case: show syntax-highlighted content preview (use Code component with truncation)
   - Keep existing behavior for other tools (Bash, Read, Glob, Grep)

2. Update PermissionDialog.module.css if needed:
   - Add styles for diff preview container
   - Ensure maxHeight constraint with scroll for large previews

Note: The existing formatToolInput returns string, but we need ReactNode for rich previews. Either:
  - Option A: Create a separate renderToolPreview function returning ReactNode
  - Option B: Change formatToolInput return type to ReactNode
  Choose Option A to minimize changes - keep formatToolInput for simple text, add renderToolPreview for rich content.
  </action>
  <verify>
    - TypeScript compiles: `cd apps/claude-code-web/client && pnpm tsc --noEmit`
    - No lint errors: `cd apps/claude-code-web/client && pnpm lint`
    - Manual test: trigger Edit tool permission dialog shows FileDiff component with colored diff
  </verify>
  <done>
    Permission dialog shows visual diff preview for Edit tool (green additions, red deletions) and syntax-highlighted content preview for Write tool, enabling users to make informed approval decisions
  </done>
</task>

</tasks>

<verification>
1. Build passes: `cd apps/claude-code-web/client && pnpm build`
2. Write tool case in ToolResultDisplay renders WriteResultDisplay with file path and content
3. Edit tool case in ToolResultDisplay renders EditResultDisplay with FileDiff
4. PermissionDialog shows FileDiff for Edit tool approvals
5. PermissionDialog shows content preview for Write tool approvals
</verification>

<success_criteria>
- Write tool results display file path with success indicator and expandable content preview
- Edit tool results display file path with inline diff using FileDiff component
- Permission dialog for Edit tool shows visual diff (additions green, deletions red)
- Permission dialog for Write tool shows syntax-highlighted content preview
- All TypeScript compiles, no lint errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-extended-tools/06-01-SUMMARY.md`
</output>
