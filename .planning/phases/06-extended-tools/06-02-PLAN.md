---
phase: 06-extended-tools
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/claude-code-web/client/src/components/BashResultDisplay.tsx
  - apps/claude-code-web/client/src/components/BashResultDisplay.module.css
  - apps/claude-code-web/client/src/components/ToolResultDisplay.tsx
autonomous: true

must_haves:
  truths:
    - "Bash tool result shows command that was executed"
    - "Bash output displays with terminal-like styling"
    - "Background Bash tasks show task ID with status indicator"
    - "Long command output is scrollable without overflowing viewport"
    - "Bash output updates progressively during execution (streaming)"
  artifacts:
    - path: "apps/claude-code-web/client/src/components/BashResultDisplay.tsx"
      provides: "Bash tool result visualization with command, streaming output, and execution state"
      exports: ["BashResultDisplay"]
  key_links:
    - from: "ToolResultDisplay.tsx"
      to: "BashResultDisplay.tsx"
      via: "switch case for 'Bash' tool"
      pattern: "case 'Bash'"
---

<objective>
Bash tool visualization with terminal-style output and streaming support

Purpose: Users need to see what command was executed and its output. Background tasks need status indication. Terminal output should feel like a real terminal for familiarity. Long-running commands should show progressive output during execution, not wait until completion.

Output: BashResultDisplay component showing command, streaming output with terminal styling, execution state, and background task handling.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-extended-tools/06-RESEARCH.md

@apps/claude-code-web/client/src/components/ToolResultDisplay.tsx
@apps/claude-code-web/client/src/components/FileContentResult.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BashResultDisplay component with streaming support</name>
  <files>
    apps/claude-code-web/client/src/components/BashResultDisplay.tsx
    apps/claude-code-web/client/src/components/BashResultDisplay.module.css
  </files>
  <action>
1. Create BashResultDisplay.tsx:
   - Props interface:
     ```typescript
     interface BashResultDisplayProps {
       command: string;
       output: string;  // Accumulated output (updates during streaming)
       isExpanded: boolean;
       onToggleExpand: () => void;
       description?: string;
       isBackground?: boolean;
       isExecuting?: boolean;  // True while command is running
       timeout?: number;
     }
     ```
   - Render command prompt line: `$ {command}`
   - If description provided, show it as a subtle label above command
   - When expanded, show output in a scrollable pre/code block
   - Terminal-style appearance: dark background, monospace font
   - For background tasks (isBackground=true), show "Running in background" indicator
   - Max height ~400px with overflow scroll for long output
   - Collapse header should show command (truncated if long) and output line count

   **Streaming behavior:**
   - The `output` prop is the accumulated output that grows during execution
   - When `isExecuting=true`, show a spinner/indicator that command is still running
   - The SDK's SSE stream sends `raw_exec_output` events that update the message state
   - As the parent ChatMessage re-renders with updated output, BashResultDisplay receives the new accumulated output
   - No additional hooks needed - streaming is handled by SDK events updating component state through React props
   - Auto-scroll to bottom when new output arrives (if already scrolled to bottom)

2. Create BashResultDisplay.module.css:
   - Terminal container: dark background (--color-panel-background or similar dark surface)
   - Command line: display with $ prefix, monospace font
   - Output: monospace, white/light text on dark background
   - Use CSS custom property for max-height: --bash-output-max-height: 400px
   - Scrollable overflow
   - Add styles for background task indicator (subtle pulsing dot or similar)
   - Add styles for executing state (spinner placement)

Design tokens to use:
- Font: var(--font-family-mono)
- Background: Consider a darker surface for terminal feel, or --color-panel-background
- Text: --color-body-text
- Spacing: var(--spacing-small10), var(--spacing)
  </action>
  <verify>
    - File exists at apps/claude-code-web/client/src/components/BashResultDisplay.tsx
    - Component has isExecuting prop for streaming state indication
    - TypeScript compiles: `cd apps/claude-code-web/client && pnpm tsc --noEmit`
  </verify>
  <done>
    BashResultDisplay component renders command prompt style with $ prefix, terminal-style output display, streaming execution indicator, and background task indicator
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate BashResultDisplay into ToolResultDisplay router with execution state</name>
  <files>
    apps/claude-code-web/client/src/components/ToolResultDisplay.tsx
  </files>
  <action>
1. Import BashResultDisplay in ToolResultDisplay.tsx

2. Add case 'Bash' in the switch statement:
   - Extract from input: command (string), description (string|undefined), run_in_background (boolean|undefined), timeout (number|undefined)
   - Determine execution state: if tool result exists, execution is complete; if called but no result yet, still executing
   - The SDK streaming sends partial results during execution - check if output is still being accumulated
   - Render BashResultDisplay with:
     - command: input.command
     - output: output (the tool result string - accumulates during streaming)
     - isExpanded: isExpanded
     - onToggleExpand: onToggleExpand
     - description: input.description
     - isBackground: input.run_in_background
     - isExecuting: Determine from tool call state (tool_use without matching result = executing)
     - timeout: input.timeout

3. Also handle 'TaskOutput' tool if present:
   - TaskOutput is used to retrieve background task output
   - Extract task_id from input
   - Display similar to Bash output
   - For now, render with BashResultDisplay using a label like "Task output for: {task_id}"

Note on streaming: The SDK's EventSource/WebSocket connection delivers `raw_exec_output` events during Bash execution. These update the message state in the chat context, which propagates to ToolResultDisplay via props. The output string grows as execution proceeds. BashResultDisplay receives updated output via normal React re-renders - no special hook needed.
  </action>
  <verify>
    - TypeScript compiles: `cd apps/claude-code-web/client && pnpm tsc --noEmit`
    - No lint errors: `cd apps/claude-code-web/client && pnpm lint`
  </verify>
  <done>
    Bash and TaskOutput tools route to BashResultDisplay in ToolResultDisplay, showing command/output with terminal styling and streaming execution state
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify build and test Bash tool display</name>
  <files>
    apps/claude-code-web/client/src/components/BashResultDisplay.tsx
    apps/claude-code-web/client/src/components/BashResultDisplay.module.css
  </files>
  <action>
1. Run full client build to verify no errors:
   ```bash
   cd apps/claude-code-web/client && pnpm build
   ```

2. Run lint check:
   ```bash
   cd apps/claude-code-web/client && pnpm lint
   ```

3. Fix any build or lint errors that arise

4. Verify CSS module is imported correctly in BashResultDisplay.tsx

5. Ensure BashResultDisplay handles edge cases:
   - Empty output: show "(no output)" or similar
   - Very long command: truncate in collapsed header with ellipsis
   - Very long output: scroll works, no performance issues
   - Streaming in progress: spinner visible, auto-scroll works
  </action>
  <verify>
    - `cd apps/claude-code-web/client && pnpm build` succeeds
    - `cd apps/claude-code-web/client && pnpm lint` has no errors
  </verify>
  <done>
    BashResultDisplay builds without errors, handles edge cases gracefully including streaming state, and integrates into the tool result display system
  </done>
</task>

</tasks>

<verification>
1. Build passes: `cd apps/claude-code-web/client && pnpm build`
2. Lint passes: `cd apps/claude-code-web/client && pnpm lint`
3. ToolResultDisplay routes 'Bash' tool to BashResultDisplay
4. Command shows with $ prefix in terminal style
5. Output displays in scrollable container without viewport overflow
6. Executing state shows spinner when isExecuting=true
7. Background task indicator renders when isBackground=true
</verification>

<success_criteria>
- Bash tool results display command with $ prefix and description (if present)
- Output shows in terminal-style container with monospace font
- Long output scrolls within max-height container without overflowing viewport
- Executing commands show progress indicator (spinner)
- Background tasks show indicator
- Build and lint pass
</success_criteria>

<output>
After completion, create `.planning/phases/06-extended-tools/06-02-SUMMARY.md`
</output>
