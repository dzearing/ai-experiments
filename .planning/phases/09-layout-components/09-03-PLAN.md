---
phase: 09-layout-components
plan: 03
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - packages/ui-kit/react/src/components/SidePanel/SidePanel.tsx
  - packages/ui-kit/react/src/components/SidePanel/SidePanel.module.css
  - packages/ui-kit/react/src/components/SidePanel/SidePanel.stories.tsx
  - packages/ui-kit/react/src/index.ts
autonomous: true

must_haves:
  truths:
    - "SidePanel supports overlay mode with portal, backdrop, and focus trap"
    - "SidePanel supports push mode with inline rendering"
    - "SidePanel can be positioned on left or right edge"
    - "Escape key closes the panel when closeOnEscape is true"
    - "Component is exported from @ui-kit/react"
  artifacts:
    - path: "packages/ui-kit/react/src/components/SidePanel/SidePanel.tsx"
      provides: "SidePanel component with overlay and push modes"
      exports: ["SidePanel", "SidePanelProps", "SidePanelMode", "SidePanelPosition", "SidePanelSize"]
    - path: "packages/ui-kit/react/src/components/SidePanel/SidePanel.module.css"
      provides: "Styling for both modes with animations"
      contains: ".overlay"
  key_links:
    - from: "packages/ui-kit/react/src/components/SidePanel/SidePanel.tsx"
      to: "packages/ui-kit/react/src/hooks/useFocusTrap.ts"
      via: "useFocusTrap import and call"
      pattern: "useFocusTrap\\(panelRef"
    - from: "packages/ui-kit/react/src/components/SidePanel/SidePanel.module.css"
      to: "packages/ui-kit/react/src/styles/z-index.css"
      via: "z-index token usage"
      pattern: "var\\(--z-sidebar\\)"
---

<objective>
Create SidePanel component with overlay and push modes

Purpose: Provide a flexible side panel for navigation, detail views, or contextual content. Overlay mode works like a drawer (modal with backdrop). Push mode resizes sibling content inline.

Output: SidePanel component with both modes, proper focus management, and keyboard support
</objective>

<execution_context>
@/Users/dzearing/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dzearing/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-layout-components/09-RESEARCH.md
@packages/ui-kit/react/src/components/Drawer/Drawer.tsx
@packages/ui-kit/react/src/components/Drawer/Drawer.module.css
@packages/ui-kit/react/src/hooks/useFocusTrap.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SidePanel component</name>
  <files>
    packages/ui-kit/react/src/components/SidePanel/SidePanel.tsx
  </files>
  <action>
Create SidePanel component using existing Drawer as reference for overlay mode.

**Type definitions:**
```typescript
export type SidePanelMode = 'overlay' | 'push';
export type SidePanelPosition = 'left' | 'right';
export type SidePanelSize = 'sm' | 'md' | 'lg' | 'auto';

export interface SidePanelProps {
  /** Whether panel is open */
  open: boolean;
  /** Close callback */
  onClose: () => void;
  /** Display mode: overlay (modal-like) or push (inline) */
  mode?: SidePanelMode;
  /** Panel position */
  position?: SidePanelPosition;
  /** Panel width */
  size?: SidePanelSize;
  /** Close on backdrop click (overlay mode only) */
  closeOnBackdrop?: boolean;
  /** Close on Escape key */
  closeOnEscape?: boolean;
  /** Panel header content */
  header?: ReactNode;
  /** Panel content */
  children: ReactNode;
  /** Additional className */
  className?: string;
}
```

**Implementation details:**

1. **Shared behavior:**
   - Escape key handler (when closeOnEscape=true)
   - panelRef for DOM reference

2. **Push mode (mode='push'):**
   - Render inline (no portal)
   - Use aside element with data-state="open"|"closed"
   - Width controlled by size prop
   - CSS handles open/closed transition (width or transform)
   - No focus trap (content is part of normal page flow)
   - Parent layout handles sibling resizing (SidePanel just reports its width)

3. **Overlay mode (mode='overlay'):**
   - Render via createPortal to document.body
   - Include backdrop element (click to close if closeOnBackdrop=true)
   - Use useFocusTrap hook when open
   - Use z-index: var(--z-sidebar)
   - role="dialog" and aria-modal="true"
   - Lock body scroll when open

4. **Structure for both modes:**
   - Header slot (optional): contains close button, title
   - Content slot: children with scrollable overflow

Default values: mode='push', position='left', size='md', closeOnBackdrop=true, closeOnEscape=true

Reference Drawer.tsx for portal, focus trap, and escape handling patterns.
  </action>
  <verify>
TypeScript compiles without errors.
All types and component exported.
  </verify>
  <done>
SidePanel component created with overlay and push modes, focus trap, and keyboard support.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SidePanel CSS module</name>
  <files>
    packages/ui-kit/react/src/components/SidePanel/SidePanel.module.css
  </files>
  <action>
Create CSS module for SidePanel with both mode styles.

**Base panel styles:**
- Background: var(--panel-bg) or var(--soft-bg)
- Border on adjacent edge: var(--soft-border)
- Box shadow for depth (overlay mode)
- Flex column layout (header + content)

**Size variants:**
- .size-sm: 280px width
- .size-md: 360px width
- .size-lg: 480px width
- .size-auto: width auto (content-driven)

**Position variants:**
- .left: positioned on left edge, border-right
- .right: positioned on right edge, border-left

**Push mode (.push):**
- Inline rendering (no fixed positioning)
- Flex-shrink: 0 to maintain width
- Transition on width/transform for open/close
- [data-state="closed"]: width: 0 or transform: translateX(-100%)

**Overlay mode (.overlay):**
- Fixed positioning (inset-block: 0)
- z-index: var(--z-sidebar)
- Slide-in animation from edge
- Backdrop styles in .backdrop class:
  - position: fixed, inset: 0
  - background: var(--overlay-bg) or rgba(0,0,0,0.5)
  - z-index: var(--z-modal-backdrop)

**Header and content:**
- .header: padding, border-bottom, flex-shrink: 0
- .content: flex: 1, overflow-y: auto, padding

**Animations:**
- slideInLeft, slideInRight keyframes
- Use var(--duration-normal) and var(--ease-default)
- @media (prefers-reduced-motion: reduce) - disable animations

Reference Drawer.module.css for animation patterns.
  </action>
  <verify>
CSS file parses without errors.
Contains overlay, push, left, right, and size-* classes.
  </verify>
  <done>
SidePanel CSS module complete with all mode and position variants.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add exports and Storybook stories</name>
  <files>
    packages/ui-kit/react/src/index.ts
    packages/ui-kit/react/src/components/SidePanel/SidePanel.stories.tsx
  </files>
  <action>
**Add exports to index.ts:**
```typescript
export {
  SidePanel,
  type SidePanelProps,
  type SidePanelMode,
  type SidePanelPosition,
  type SidePanelSize
} from './components/SidePanel/SidePanel';
```

**SidePanel.stories.tsx:**

1. **PushMode (default):**
   - Open/close button outside panel
   - Panel content with navigation list
   - Show how sibling content adjusts

2. **OverlayMode:**
   - Trigger button
   - Backdrop visible
   - Focus trap active (Tab cycles within panel)
   - Click backdrop to close

3. **RightPosition:**
   - mode="push" or "overlay", position="right"

4. **WithHeader:**
   - Header slot with title and close button
   - Scrollable content below

5. **Sizes:**
   - sm, md, lg variants side by side or selectable

6. **Controlled:**
   - useState for open state
   - Interactive toggle demonstration

Use Drawer.stories.tsx as reference for story structure.

Build and test:
cd packages/ui-kit/react && pnpm build
  </action>
  <verify>
pnpm build succeeds.
Stories render correctly in Storybook.
Push mode: panel width changes content flow.
Overlay mode: backdrop appears, focus trapped.
  </verify>
  <done>
SidePanel exported from package with comprehensive Storybook stories for all modes.
  </done>
</task>

</tasks>

<verification>
1. packages/ui-kit/react builds successfully
2. SidePanel renders in push mode (inline, no backdrop)
3. SidePanel renders in overlay mode (portal, backdrop, focus trap)
4. Escape key closes panel
5. Backdrop click closes panel in overlay mode
6. z-index tokens used (var(--z-sidebar))
7. Stories demonstrate all modes and positions
</verification>

<success_criteria>
- SidePanel component complete with push and overlay modes
- Focus trapping works in overlay mode
- Keyboard navigation (Escape to close) works
- Both left and right positions supported
- Three size variants (sm, md, lg) plus auto
- Animations smooth with reduced-motion support
- Component exported from @ui-kit/react
</success_criteria>

<output>
After completion, create `.planning/phases/09-layout-components/09-03-SUMMARY.md`
</output>
