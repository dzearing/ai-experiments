import { Meta } from '@storybook/blocks';

<Meta title="Foundations/Focus State" />

# Focus State

Focus indicators are critical for keyboard navigation and accessibility. They show users which element is currently active and ready to receive input.

## Principles

### 1. Always Visible When Interacting via Keyboard
Focus indicators must be clearly visible when users navigate with keyboard (Tab, Shift+Tab, arrow keys), but should NOT appear during mouse or touch interactions. Use `:focus-visible` to achieve keyboard-only focus.

### 2. Prefer Focus Outlines Inside Render Area
Focus indicators should be rendered within the component's boundaries to prevent clipping by parent containers with `overflow: hidden`. Use negative `outline-offset` or `box-shadow: inset` for internal borders.

### 3. WCAG Compliance
Focus indicators must meet WCAG 2.1 Level AA requirements:
- **3:1 contrast ratio** against adjacent colors
- **2px minimum width** for the focus indicator
- Clearly distinguishable from hover states

## Implementation Patterns

### Standard Focus Ring (Internal)

Most interactive elements should use an internal focus ring to avoid clipping:

```css
.button:focus-visible {
  outline: 2px solid var(--color-[surface]-outline);
  outline-offset: -2px; /* Internal to avoid clipping */
}
```

### Integrated Focus Style

For form inputs and elements where an outline would disrupt the design, use an integrated approach:

```css
.input:focus-visible {
  border-color: var(--color-[surface]-outline);
  box-shadow: inset 0 0 0 2px var(--color-[surface]-outline);
}
```

### High Contrast Focus

For elements that need extra emphasis or in high-contrast themes:

```css
.critical-action:focus-visible {
  outline: 3px solid var(--color-[surface]-outline);
  outline-offset: -3px; /* Thicker internal border */
  box-shadow: inset 0 0 0 1px var(--color-[surface]-background);
}
```

## Token Usage

### Outline Tokens

Each surface provides an outline token that ensures proper contrast:

- `--color-body-outline` - For elements on body background
- `--color-panel-outline` - For elements on panel background
- `--color-primary-outline` - For elements on primary background
- etc.

### Special Tokens

For consistent focus styling across themes:

- `--focus-ring-color` - Legacy token (prefer surface-specific outline)
- `--focus-ring-offset` - Standard offset for focus rings (2px)

## Best Practices

### Do's

✅ **Use `:focus-visible`** for better UX
```css
/* Good - Only shows focus ring for keyboard navigation */
.button:focus-visible {
  outline: 2px solid var(--color-body-outline);
}
```

✅ **Use internal focus borders** to prevent clipping
```css
/* Good - Internal border won't be clipped */
.card:focus-visible {
  outline: 2px solid var(--color-panel-outline);
  outline-offset: -2px;
}
```

✅ **Use surface-appropriate tokens**
```css
/* Good - Uses correct surface token */
.panel-button:focus-visible {
  outline: 2px solid var(--color-panel-outline);
}
```

### Don'ts

❌ **Never remove focus indicators** without replacement
```css
/* Bad - Removes accessibility */
.button:focus {
  outline: none;
}
```

❌ **Don't use color alone** to indicate focus
```css
/* Bad - Not accessible for colorblind users */
.button:focus {
  background: var(--color-primary-background);
}
```

❌ **Avoid thin or low-contrast** focus indicators
```css
/* Bad - May not meet WCAG requirements */
.button:focus {
  outline: 1px solid rgba(0, 0, 0, 0.2);
}
```

## Examples by Component Type

### Buttons
```css
.button:focus-visible {
  outline: 2px solid var(--color-body-outline);
  outline-offset: -2px; /* Internal to avoid clipping */
}
```

### Form Inputs
```css
.input:focus-visible {
  outline: 2px solid var(--color-input-outline);
  outline-offset: -2px; /* Internal focus border */
}
```

### Links
```css
.link:focus-visible {
  outline: 2px solid var(--color-body-outline);
  outline-offset: -2px; /* Internal to stay within bounds */
  border-radius: 2px; /* Rounds the focus ring */
}
```

### Cards and Clickable Containers
```css
.card-interactive:focus-visible {
  outline: 2px solid var(--color-panel-outline);
  outline-offset: -2px; /* Inside the card boundary */
}
```

## Keyboard Navigation Tips

1. **Tab Order**: Ensure logical tab order with proper HTML structure
2. **Skip Links**: Provide skip links for repetitive navigation
3. **Focus Trapping**: Trap focus in modals and overlays
4. **Focus Management**: Return focus to trigger element when closing overlays

## Testing Focus States

1. **Keyboard Testing**: Navigate using only Tab, Shift+Tab, Enter, and Space
2. **Screen Reader**: Test with screen readers to ensure focus is announced
3. **Contrast Check**: Verify 3:1 contrast ratio for focus indicators
4. **Browser Testing**: Test across browsers as focus-visible support varies

## Theme Considerations

The outline tokens automatically adjust for:
- **Light/Dark modes**: Ensuring visibility in both themes
- **High Contrast**: Meeting AAA requirements when needed
- **Surface colors**: Adapting to different background colors

Always use the semantic outline tokens rather than hardcoding colors to ensure your focus states work across all themes and color modes.