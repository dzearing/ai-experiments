/* ChatMessage - 3 column layout: Avatar | Time | Content */
.message {
  display: flex;
  flex-direction: row;
  align-items: baseline;
  gap: var(--space-2);
}

/* First message from a sender - add spacing above */
.message:not(.consecutive) {
  margin-top: var(--space-2);
}

/* Consecutive messages - no extra spacing */
.message.consecutive {
  /* No margin - content flows like multiline text */
}

/* Column 1: Avatar + Name stacked */
.avatarColumn {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-1);
  flex-shrink: 0;
  width: 72px;
  align-self: flex-start;
}

/* Hide avatar column for consecutive messages or when hidden */
.avatarColumn.hidden {
  visibility: hidden;
}

.senderName {
  font-size: 11px;
  font-weight: var(--weight-medium);
  text-align: center;
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Column 2: Timestamp */
.timestamp {
  flex-shrink: 0;
  width: 64px; /* Fixed width for alignment */
  font-size: 11px;
  color: var(--base-fg-soft);
  white-space: nowrap;
  transition: opacity var(--duration-fast) var(--ease-default);
}

/* Clickable timestamp button */
.timestampButton {
  flex-shrink: 0;
  width: 64px;
  font-size: 11px;
  color: var(--base-fg-soft);
  white-space: nowrap;
  transition: opacity var(--duration-fast) var(--ease-default),
              color var(--duration-fast) var(--ease-default);
  background: none;
  border: none;
  padding: 0;
  margin: 0;
  cursor: pointer;
  text-align: left;
  font-family: inherit;
}

.timestampButton:hover {
  color: var(--base-fg);
}

/* First message from sender - always show timestamp */
.message:not(.consecutive) .timestamp,
.message:not(.consecutive) .timestampButton {
  opacity: 1;
}

/* Consecutive messages - only show on hover */
.message.consecutive .timestamp,
.message.consecutive .timestampButton {
  opacity: 0;
}

.message.consecutive:hover .timestamp,
.message.consecutive:hover .timestampButton {
  opacity: 1;
}

/* Column 3: Message content */
.content {
  flex: 1;
  min-width: 0;
}

/* Markdown content styling */
.markdownContent {
  font-size: var(--text-sm);
  color: var(--base-fg);
  line-height: var(--leading-relaxed);
  word-wrap: break-word;
}

/* Inline code */
.markdownContent code {
  background: var(--strong-bg);
  border: 1px solid var(--strong-border);
  padding: 0.1em 0.4em;
  border-radius: var(--radius-sm);
  font-family: var(--font-mono);
  font-size: 0.9em;
  color: var(--strong-fg);
}

.markdownContent pre {
  background: var(--soft-bg);
  padding: var(--space-3);
  border-radius: var(--radius-md);
  overflow-x: auto;
  margin: var(--space-2) 0;
}

.markdownContent pre code {
  background: none;
  padding: 0;
  border: none;
}

/* Highlighted/Own message style */
.highlighted {
  background: var(--strong-bg);
  margin-left: calc(-1 * var(--space-4));
  margin-right: calc(-1 * var(--space-4));
  padding-left: var(--space-4);
  padding-right: var(--space-4);
  padding-top: var(--space-1);
  padding-bottom: var(--space-1);
  border-radius: var(--radius-md);
}

/* Consecutive highlighted messages - seamless connection */
.highlighted.consecutive {
  border-top-left-radius: 0;
  border-top-right-radius: 0;
}

/* Highlighted followed by another highlighted - no bottom radius */
.highlighted:has(+ .highlighted) {
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
}

.highlighted .markdownContent {
  color: var(--strong-fg);
}

.highlighted .timestamp,
.highlighted .timestampButton {
  color: var(--strong-fg-soft);
}

/* Streaming indicator */
.streamingIndicator {
  display: inline-flex;
  margin-inline-start: var(--space-1);
  vertical-align: middle;
}

/* Tool calls section */
.toolCalls {
  display: flex;
  flex-direction: column;
  gap: 0;
  margin-top: var(--space-3);
  margin-bottom: var(--space-3);
  padding: 0 var(--space-3);
  background: var(--strong-bg);
  border-radius: var(--radius-sm);
  border: 1px solid var(--strong-border);
  font-size: var(--text-xs);
  max-width: 400px;
  /* Prevent browser from using this as scroll anchor */
  overflow-anchor: none;
}

.toolCallWrapper {
  display: flex;
  flex-direction: column;
  gap: 0;
  /* Prevent browser from using this as scroll anchor */
  overflow-anchor: none;
}

.toolCall {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  height: 36px;
  padding: 0 var(--space-3);
  margin: 0 calc(-1 * var(--space-3));
  /* Reset button styles */
  background: none;
  border: none;
  font: inherit;
  text-align: left;
  width: calc(100% + var(--space-6));
}

.toolCall:disabled {
  cursor: default;
}

.toolExpandable {
  cursor: pointer;
  transition: background var(--duration-fast) var(--ease-default);
}

.toolExpandable:hover {
  background: var(--strong-bg);
}

.toolChevron {
  flex-shrink: 0;
  width: 16px;
  height: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--base-fg-soft);
  margin-left: auto;
  transition: transform var(--duration-fast) var(--ease-default);
}

.toolChevron svg {
  width: 14px;
  height: 14px;
}

.toolChevronExpanded {
  transform: rotate(180deg);
}

.toolIcon {
  flex-shrink: 0;
  width: 16px;
  height: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
}

.toolIcon svg {
  width: 14px;
  height: 14px;
}

.toolRunning .toolIcon {
  color: var(--base-fg-soft);
}

.toolComplete .toolIcon {
  color: var(--base-fg-success);
}

.toolDescription {
  color: var(--base-fg-soft);
}

.toolDescription strong {
  color: var(--base-fg);
  font-weight: var(--weight-medium);
}

.toolComplete .toolDescription {
  color: var(--base-fg-softer);
}

.toolComplete .toolDescription strong {
  color: var(--base-fg-soft);
}

.toolCancelled .toolIcon {
  color: var(--base-fg-soft);
}

.toolCancelled .toolDescription {
  color: var(--base-fg-softer);
}

.toolCancelled .toolDescription strong {
  color: var(--base-fg-soft);
}

/* Tool timer */
.toolTimerRunning {
  margin-left: var(--space-2);
  font-size: var(--text-xs);
  color: var(--base-fg-soft);
  font-variant-numeric: tabular-nums;
}

.toolTimerComplete {
  margin-left: var(--space-2);
  font-size: var(--text-xs);
  color: var(--base-fg);
  font-variant-numeric: tabular-nums;
}

/* Tool result output */
.toolResult {
  margin-left: calc(16px + var(--space-2));
  padding: var(--space-1) var(--space-2);
  background: var(--base-bg);
  border-radius: var(--radius-xs);
  border: 1px solid var(--strong-border);
  /* Prevent browser from using this as scroll anchor */
  overflow-anchor: none;
}

.toolResultContent {
  margin: 0;
  font-size: var(--text-xs);
  font-family: var(--font-mono);
  color: var(--base-fg-soft);
  white-space: pre-wrap;
  word-break: break-word;
  max-height: 100px;
  overflow-y: auto;
}

/* Plain text content (for user messages without markdown) */
.plainText {
  margin: 0;
  font-size: var(--text-sm);
  color: var(--base-fg);
  line-height: var(--leading-relaxed);
  word-wrap: break-word;
  white-space: pre-wrap;
}

/* Text parts within interleaved content */
.textPart {
  /* No extra spacing needed, markdown renderer handles it */
}

.componentPart {
  /* Container for custom components like ContextDisplay */
  margin: var(--space-2, 8px) 0;
}

.highlighted .plainText {
  color: var(--strong-fg);
}

/* System message - full width, distinct styling */
.systemMessage {
  display: flex;
  justify-content: center;
  padding: var(--space-2) var(--space-4);
  margin: var(--space-2) 0;
}

.systemContent {
  display: inline-flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2) var(--space-4);
  background: var(--soft-bg);
  border: 1px solid var(--soft-border);
  border-radius: var(--radius-full);
  max-width: 90%;
}

.systemMarkdown,
.systemText {
  margin: 0;
  font-size: var(--text-xs);
  font-style: italic;
  color: var(--soft-fg-soft);
  text-align: center;
}

/* ============================================
   1-ON-1 MODE STYLES
   Subtle emphasis design for two-person chats
   ============================================ */

/* Base class for 1-on-1 mode messages */
.oneOnOneMessage {
  position: relative;
  border-radius: var(--radius-lg);
  padding: var(--space-3) var(--space-4);
  margin-bottom: var(--space-2);
  /* Toolbar text alignment - matches content padding */
  --toolbar-padding-left: var(--space-4);
}

/* User message styling - uses surface primary class for token remapping */
.oneOnOneUserMessage {
  background: var(--base-bg);
  color: var(--base-fg);
}

/* Assistant message styling - transparent background */
.oneOnOneAssistantMessage {
  background: transparent;
  color: var(--base-fg);
}

/* Override highlighted styling in 1-on-1 mode - let oneOnOne styles take precedence */
.oneOnOneMessage.highlighted {
  background: inherit;
  margin-left: 0;
  margin-right: 0;
  padding-left: var(--space-4);
  padding-right: var(--space-4);
  padding-top: var(--space-3);
  padding-bottom: var(--space-3);
}

/* User message background takes precedence when both classes present */
.oneOnOneUserMessage.highlighted {
  background: var(--primary-bg);
}

/* User message text uses base tokens - surface primary remaps them */
.oneOnOneUserMessage .markdownContent {
  color: var(--base-fg);
}

.oneOnOneUserMessage .plainText {
  color: var(--base-fg);
}

/* ============================================
   GROUP MODE STYLES
   Multi-participant chat with avatars and names
   ============================================ */

/* Base class for group mode messages */
.groupMessage {
  position: relative;
  display: flex;
  gap: var(--space-2);
  padding: var(--space-2);
  border-radius: var(--radius-lg);
  margin-bottom: var(--space-2);
  /* Toolbar text alignment - message padding + avatar + gap */
  --toolbar-padding-left: calc(var(--space-2) + 24px + var(--space-2));
}

/* User's own messages - uses surface primary class for token remapping */
.groupMessageUser {
  background: var(--base-bg);
  color: var(--base-fg);
}

/* Other participants' messages - transparent background */
.groupMessageOther {
  background: transparent;
  color: var(--base-fg);
}

/* Avatar indicator (small colored circle with initials) */
.groupSenderIndicator {
  flex-shrink: 0;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 9px;
  font-weight: var(--weight-semibold);
  color: white;
}

/* Message body container (name + content) */
.groupMessageBody {
  flex: 1;
  min-width: 0;
}

/* Sender name above content */
.groupSenderName {
  font-size: var(--text-xs);
  font-weight: var(--weight-medium);
  margin-bottom: var(--space-1);
  opacity: 0.85;
}

/* Sender name color variants */
.groupSenderNameUser {
  color: var(--base-fg-soft);
}

.groupSenderNameOther {
  color: var(--base-fg-soft);
}

/* Message content wrapper */
.groupContent {
  font-size: var(--text-sm);
  line-height: var(--leading-relaxed);
}

/* Consecutive messages from same sender - compact mode */
.groupMessage[data-consecutive="true"] .groupSenderIndicator {
  visibility: hidden;
}

.groupMessage[data-consecutive="true"] .groupSenderName {
  display: none;
}

.groupMessage[data-consecutive="true"] {
  margin-top: calc(-1 * var(--space-1));
  padding-top: var(--space-2);
}

/* Override highlighted styling in group mode - let groupMessage styles take precedence */
.groupMessage.highlighted {
  background: inherit;
  margin-left: 0;
  margin-right: 0;
  padding-left: var(--space-2);
  padding-right: var(--space-2);
  padding-top: var(--space-2);
  padding-bottom: var(--space-2);
}

/* User message background takes precedence when both classes present */
.groupMessageUser.highlighted {
  background: var(--primary-bg);
}

/* Group mode user message text uses base tokens - surface primary remaps them */
.groupMessageUser .markdownContent {
  color: var(--base-fg);
}

.groupMessageUser .plainText {
  color: var(--base-fg);
}

/* ============================================
   MESSAGE TOOLBAR (HOVER REVEAL)
   Shows on message hover with timestamp and actions
   ============================================ */

/* Message toolbar positioning - flush above message, left-aligned */
.messageToolbar {
  left: 0;
  bottom: calc(100% - 1px);
  opacity: 0;
  z-index: 1;
}

/* Show toolbar and border on hover, focus, or focus-within */
.oneOnOneMessage:hover .messageToolbar,
.oneOnOneMessage:focus .messageToolbar,
.oneOnOneMessage:focus-within .messageToolbar,
.groupMessage:hover .messageToolbar,
.groupMessage:focus .messageToolbar,
.groupMessage:focus-within .messageToolbar {
  opacity: 1;
}

/* Border around message on hover - base tokens (surface classes handle remapping) */
.oneOnOneUserMessage::after,
.groupMessageUser::after,
.oneOnOneAssistantMessage::after,
.groupMessageOther::after {
  content: '';
  position: absolute;
  inset: 0;
  border: 1px solid var(--base-border);
  border-radius: 0 var(--radius-lg) var(--radius-lg) var(--radius-lg);
  opacity: 0;
  pointer-events: none;
}

/* Show border and hover background on hover, focus, or focus-within */
.oneOnOneMessage:hover::after,
.oneOnOneMessage:focus::after,
.oneOnOneMessage:focus-within::after,
.groupMessage:hover::after,
.groupMessage:focus::after,
.groupMessage:focus-within::after {
  opacity: 1;
}

/* Hover/focus state for all messages - base tokens (surface classes handle remapping) */
.oneOnOneUserMessage:hover,
.oneOnOneUserMessage:focus,
.oneOnOneUserMessage:focus-within,
.groupMessageUser:hover,
.groupMessageUser:focus,
.groupMessageUser:focus-within,
.oneOnOneAssistantMessage:hover,
.oneOnOneAssistantMessage:focus,
.oneOnOneAssistantMessage:focus-within,
.groupMessageOther:hover,
.groupMessageOther:focus,
.groupMessageOther:focus-within {
  background: var(--base-bg);
  border-radius: 0 var(--radius-lg) var(--radius-lg) var(--radius-lg);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
}

/* Focus ring for keyboard navigation */
.oneOnOneMessage:focus-visible,
.groupMessage:focus-visible {
  outline: var(--focus-ring-width) solid var(--focus-ring);
  outline-offset: var(--focus-ring-offset);
}
