<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NPM Dependency Visualizer - Package Detail View</title>
    
    <!-- 1. Link to UI Kit styles -->
    <link rel="stylesheet" href="/assets/styles.css">
    
    <!-- 2. Set base path for themes -->
    <script>
        window.__uiKitBasePath = '/assets/';
    </script>
    
    <!-- 3. Load theme engine (auto-initializes) -->
    <script type="module" src="/assets/theme.js"></script>
    
    <!-- 4. Optional: Theme switcher UI -->
    <script type="module" src="/assets/theme-switcher.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--color-body-background);
            color: var(--color-body-text);
            font-size: var(--font-size);
            line-height: var(--line-height);
        }

        .detail-container {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            height: 100vh;
            gap: 1px;
            background: var(--color-panel-border);
        }

        /* Left Panel - Dependents */
        .dependents-panel {
            background: var(--color-panel-background);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Center - Package Focus */
        .package-focus {
            background: var(--gradient-body-accent), var(--color-body-background);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Right Panel - Dependencies */
        .dependencies-panel {
            background: var(--color-panel-background);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Panel Headers */
        .panel-header {
            padding: var(--spacing);
            border-bottom: 1px solid var(--color-panel-border);
            background: var(--gradient-body-primary), var(--color-panel-background);
        }

        .panel-title {
            font-size: var(--font-size-h6);
            font-weight: var(--font-weight-semibold);
            display: flex;
            align-items: center;
            gap: var(--spacing-small10);
        }

        .panel-subtitle {
            font-size: var(--font-size-small10);
            color: var(--color-body-textSoft20);
            margin-top: var(--spacing-small20);
        }

        /* Package Card Styles */
        .package-list {
            padding: var(--spacing);
            overflow-y: auto;
            flex: 1;
        }

        .package-card {
            background: var(--color-body-background);
            border: 1px solid var(--color-body-borderSoft10);
            border-radius: var(--radius-container);
            padding: var(--spacing);
            margin-bottom: var(--spacing-small10);
            cursor: pointer;
            transition: all var(--duration-fast10) var(--easing-default);
            position: relative;
        }

        .package-card:hover {
            border-color: var(--color-primary-background);
            box-shadow: var(--shadow-card);
            transform: translateX(4px);
        }

        .package-card.cyclic {
            border-left: 3px solid var(--color-warning-background);
        }

        .package-card.external {
            background: var(--color-panel-background);
            border-style: dashed;
        }

        .package-name {
            font-weight: var(--font-weight-medium);
            margin-bottom: var(--spacing-small20);
        }

        .package-version {
            font-size: var(--font-size-small20);
            color: var(--color-body-textSoft20);
        }

        .package-stats {
            display: flex;
            gap: var(--spacing);
            margin-top: var(--spacing-small10);
            font-size: var(--font-size-small20);
            color: var(--color-body-textSoft10);
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-small20);
        }

        /* Center Focus Area */
        .focus-header {
            padding: var(--spacing-large20);
            text-align: center;
        }

        .focus-package-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--spacing);
            background: var(--gradient-body-primary), var(--color-primary-background);
            border-radius: var(--radius-modal);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-card);
        }

        .focus-package-name {
            font-size: var(--font-size-h3);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--spacing-small10);
        }

        .focus-package-version {
            display: inline-block;
            padding: var(--spacing-small20) var(--spacing-small10);
            background: var(--color-successSoft-background);
            color: var(--color-successSoft-text);
            border-radius: var(--radius-interactive);
            font-size: var(--font-size-small10);
            margin-bottom: var(--spacing);
        }

        .focus-package-description {
            color: var(--color-body-textSoft10);
            max-width: 600px;
            margin: 0 auto var(--spacing-large10);
        }

        /* Connection Visualization */
        .connection-viz {
            flex: 1;
            position: relative;
            padding: var(--spacing-large20);
        }

        .connection-canvas {
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* Connection Lines SVG */
        .connection-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .connection-line {
            stroke: var(--color-body-borderSoft10);
            stroke-width: 2;
            fill: none;
            stroke-dasharray: 5,5;
            animation: dash 20s linear infinite;
        }

        @keyframes dash {
            to {
                stroke-dashoffset: -100;
            }
        }

        .connection-line.direct {
            stroke: var(--color-success-background);
            stroke-dasharray: none;
            stroke-width: 3;
        }

        .connection-line.cyclic {
            stroke: var(--color-warning-background);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--spacing);
            padding: var(--spacing-large20);
            background: var(--color-panel-background);
            border-radius: var(--radius-container);
            margin: 0 var(--spacing-large20);
        }

        .stat-card {
            text-align: center;
        }

        .stat-value {
            font-size: var(--font-size-h4);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary-text);
        }

        .stat-label {
            font-size: var(--font-size-small20);
            color: var(--color-body-textSoft20);
            margin-top: var(--spacing-small20);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: var(--spacing);
            justify-content: center;
            padding: var(--spacing-large20);
        }

        .action-btn {
            padding: var(--spacing-buttonY) var(--spacing-buttonX);
            background: var(--color-neutral-background);
            border: 1px solid var(--color-neutral-border);
            border-radius: var(--radius-interactive);
            color: var(--color-neutral-text);
            font-size: var(--font-size);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--duration-fast10) var(--easing-default);
            display: flex;
            align-items: center;
            gap: var(--spacing-small10);
        }

        .action-btn:hover {
            background: var(--color-neutral-background-hover);
        }

        .action-btn.primary {
            background: var(--color-primary-background);
            color: var(--color-primary-text);
            border-color: var(--color-primary-border);
        }

        .action-btn.primary:hover {
            background: var(--color-primary-background-hover);
        }

        /* Dependency Path */
        .dep-path {
            padding: var(--spacing);
            background: var(--color-body-background);
            border-radius: var(--radius-container);
            margin: var(--spacing-small10) 0;
        }

        .dep-path-title {
            font-size: var(--font-size-small10);
            color: var(--color-body-textSoft10);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--spacing-small10);
        }

        .path-steps {
            display: flex;
            align-items: center;
            gap: var(--spacing-small10);
            overflow-x: auto;
            padding: var(--spacing-small10) 0;
        }

        .path-step {
            padding: var(--spacing-small20) var(--spacing-small10);
            background: var(--color-panel-background);
            border: 1px solid var(--color-panel-border);
            border-radius: var(--radius-interactive);
            font-size: var(--font-size-small10);
            white-space: nowrap;
            flex-shrink: 0;
        }

        .path-arrow {
            color: var(--color-body-textSoft20);
            flex-shrink: 0;
        }

        /* Filter Tags */
        .filter-tags {
            display: flex;
            gap: var(--spacing-small20);
            padding: var(--spacing-small10);
            background: var(--color-body-background);
            border-radius: var(--radius-interactive);
            margin-bottom: var(--spacing);
        }

        .filter-tag {
            padding: var(--spacing-small20) var(--spacing-small10);
            background: var(--color-primary-background);
            color: var(--color-primary-text);
            border-radius: var(--radius-round);
            font-size: var(--font-size-smallest);
            display: flex;
            align-items: center;
            gap: var(--spacing-small20);
        }

        .tag-remove {
            cursor: pointer;
            opacity: 0.7;
        }

        .tag-remove:hover {
            opacity: 1;
        }

        /* Search Box */
        .search-box {
            padding: var(--spacing-small10);
            background: var(--color-body-background);
            border-bottom: 1px solid var(--color-body-borderSoft10);
        }

        .search-input {
            width: 100%;
            padding: var(--spacing-small10) var(--spacing);
            background: var(--color-panel-background);
            border: 1px solid var(--color-body-border);
            border-radius: var(--radius-interactive);
            color: var(--color-body-text);
            font-size: var(--font-size-small10);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--color-primary-background);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .detail-container {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr 2fr 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Loading State */
        .loading-skeleton {
            background: linear-gradient(90deg, 
                var(--color-panel-background) 25%, 
                var(--color-body-background) 50%, 
                var(--color-panel-background) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: var(--radius-interactive);
            height: 20px;
            margin-bottom: var(--spacing-small10);
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Highlight Animation */
        .highlight-pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { 
                box-shadow: 0 0 0 0 var(--color-primary-background);
            }
            50% { 
                box-shadow: 0 0 0 10px transparent;
            }
        }
    </style>
</head>
<body>
    <div class="detail-container">
        <!-- Left Panel - Packages that depend on this -->
        <aside class="dependents-panel">
            <div class="panel-header">
                <h3 class="panel-title">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="7 8 3 12 7 16"/>
                        <line x1="21" y1="12" x2="3" y2="12"/>
                    </svg>
                    Imported By
                </h3>
                <div class="panel-subtitle">12 packages depend on this</div>
            </div>
            
            <div class="search-box">
                <input type="text" class="search-input" placeholder="Filter dependents..." />
            </div>

            <div class="filter-tags">
                <div class="filter-tag">
                    Direct Only
                    <span class="tag-remove">×</span>
                </div>
                <div class="filter-tag">
                    Internal
                    <span class="tag-remove">×</span>
                </div>
            </div>

            <div class="package-list">
                <div class="package-card">
                    <div class="package-name">@app/main</div>
                    <div class="package-version">v2.3.1</div>
                    <div class="package-stats">
                        <div class="stat-item">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            Direct
                        </div>
                        <div class="stat-item">23 deps</div>
                    </div>
                </div>

                <div class="package-card cyclic">
                    <div class="package-name">@monorepo/shared</div>
                    <div class="package-version">v1.0.0</div>
                    <div class="package-stats">
                        <div class="stat-item">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12"/>
                                <path d="M12 2l10 5v10c0 5.55-3.84 10.74-9 12"/>
                            </svg>
                            Cyclic
                        </div>
                        <div class="stat-item">15 deps</div>
                    </div>
                </div>

                <div class="package-card">
                    <div class="package-name">@monorepo/admin</div>
                    <div class="package-version">v1.2.0</div>
                    <div class="package-stats">
                        <div class="stat-item">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/>
                                <path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/>
                            </svg>
                            Transitive
                        </div>
                        <div class="stat-item">8 deps</div>
                    </div>
                </div>

                <div class="package-card">
                    <div class="package-name">@monorepo/dashboard</div>
                    <div class="package-version">v2.0.5</div>
                    <div class="package-stats">
                        <div class="stat-item">Direct</div>
                        <div class="stat-item">31 deps</div>
                    </div>
                </div>

                <div class="package-card">
                    <div class="package-name">@monorepo/api-gateway</div>
                    <div class="package-version">v1.5.2</div>
                    <div class="package-stats">
                        <div class="stat-item">Direct</div>
                        <div class="stat-item">12 deps</div>
                    </div>
                </div>

                <div class="dep-path">
                    <div class="dep-path-title">Shortest Path From Root</div>
                    <div class="path-steps">
                        <div class="path-step">@app/main</div>
                        <div class="path-arrow">→</div>
                        <div class="path-step">@monorepo/core</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Center - Package Focus -->
        <main class="package-focus">
            <div class="focus-header">
                <div class="focus-package-icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <line x1="9" y1="9" x2="15" y2="9"/>
                        <line x1="9" y1="12" x2="15" y2="12"/>
                        <line x1="9" y1="15" x2="12" y2="15"/>
                    </svg>
                </div>
                <h1 class="focus-package-name">@monorepo/core</h1>
                <span class="focus-package-version">v1.2.0</span>
                <p class="focus-package-description">
                    Core utilities and shared functionality for the monorepo. This package provides essential services including configuration management, logging, error handling, and common data structures used across all applications.
                </p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">12</div>
                    <div class="stat-label">Imported By</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">8</div>
                    <div class="stat-label">Dependencies</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">2</div>
                    <div class="stat-label">Cyclic Deps</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">3</div>
                    <div class="stat-label">Depth Level</div>
                </div>
            </div>

            <div class="connection-viz">
                <div class="connection-canvas">
                    <svg class="connection-svg" viewBox="0 0 100 100" preserveAspectRatio="none">
                        <!-- Connection lines -->
                        <path class="connection-line direct" d="M 0,20 Q 50,20 100,10"/>
                        <path class="connection-line direct" d="M 0,40 Q 50,40 100,30"/>
                        <path class="connection-line" d="M 0,60 Q 50,60 100,50"/>
                        <path class="connection-line cyclic" d="M 0,80 Q 50,80 100,70"/>
                        <path class="connection-line" d="M 0,30 Q 50,30 100,90"/>
                    </svg>
                </div>
            </div>

            <div class="action-buttons">
                <button class="action-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                    View in Graph
                </button>
                <button class="action-btn primary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                    </svg>
                    Analyze Impact
                </button>
                <button class="action-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="1"/>
                        <circle cx="12" cy="5" r="1"/>
                        <circle cx="12" cy="19" r="1"/>
                    </svg>
                    More Actions
                </button>
            </div>
        </main>

        <!-- Right Panel - Dependencies -->
        <aside class="dependencies-panel">
            <div class="panel-header">
                <h3 class="panel-title">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="17 8 21 12 17 16"/>
                        <line x1="3" y1="12" x2="21" y2="12"/>
                    </svg>
                    Dependencies
                </h3>
                <div class="panel-subtitle">8 packages required</div>
            </div>

            <div class="search-box">
                <input type="text" class="search-input" placeholder="Filter dependencies..." />
            </div>

            <div class="filter-tags">
                <div class="filter-tag">
                    Production
                    <span class="tag-remove">×</span>
                </div>
            </div>

            <div class="package-list">
                <div class="package-card">
                    <div class="package-name">@monorepo/utils</div>
                    <div class="package-version">^0.9.2</div>
                    <div class="package-stats">
                        <div class="stat-item">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            </svg>
                            Internal
                        </div>
                        <div class="stat-item">5 deps</div>
                    </div>
                </div>

                <div class="package-card">
                    <div class="package-name">@monorepo/logger</div>
                    <div class="package-version">^1.0.0</div>
                    <div class="package-stats">
                        <div class="stat-item">Internal</div>
                        <div class="stat-item">3 deps</div>
                    </div>
                </div>

                <div class="package-card cyclic">
                    <div class="package-name">@monorepo/config</div>
                    <div class="package-version">^2.1.0</div>
                    <div class="package-stats">
                        <div class="stat-item">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12"/>
                                <path d="M12 2l10 5v10c0 5.55-3.84 10.74-9 12"/>
                            </svg>
                            Cyclic
                        </div>
                        <div class="stat-item">7 deps</div>
                    </div>
                </div>

                <div class="package-card external">
                    <div class="package-name">lodash</div>
                    <div class="package-version">^4.17.21</div>
                    <div class="package-stats">
                        <div class="stat-item">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="2" y1="12" x2="22" y2="12"/>
                                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                            </svg>
                            External
                        </div>
                        <div class="stat-item">0 deps</div>
                    </div>
                </div>

                <div class="package-card external">
                    <div class="package-name">axios</div>
                    <div class="package-version">^1.4.0</div>
                    <div class="package-stats">
                        <div class="stat-item">External</div>
                        <div class="stat-item">8 deps</div>
                    </div>
                </div>

                <div class="dep-path">
                    <div class="dep-path-title">Critical Path</div>
                    <div class="path-steps">
                        <div class="path-step">@monorepo/core</div>
                        <div class="path-arrow">→</div>
                        <div class="path-step">@monorepo/config</div>
                        <div class="path-arrow">→</div>
                        <div class="path-step">@monorepo/shared</div>
                        <div class="path-arrow">⟲</div>
                        <div class="path-step">@monorepo/core</div>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <script>
        // Interactive functionality
        function highlightConnections() {
            const lines = document.querySelectorAll('.connection-line');
            lines.forEach((line, index) => {
                setTimeout(() => {
                    line.style.strokeOpacity = '1';
                    line.style.strokeWidth = '3';
                    setTimeout(() => {
                        line.style.strokeOpacity = '0.6';
                        line.style.strokeWidth = '2';
                    }, 1000);
                }, index * 200);
            });
        }

        // Animate connections on load
        setTimeout(highlightConnections, 500);
        setInterval(highlightConnections, 5000);

        // Package card click handlers
        document.querySelectorAll('.package-card').forEach(card => {
            card.addEventListener('click', function() {
                // Remove previous selections
                document.querySelectorAll('.package-card').forEach(c => {
                    c.classList.remove('highlight-pulse');
                });
                // Add pulse to clicked card
                this.classList.add('highlight-pulse');
                
                // Simulate loading new package details
                const packageName = this.querySelector('.package-name').textContent;
                document.querySelector('.focus-package-name').textContent = packageName;
                
                // Animate the connections
                highlightConnections();
            });
        });

        // Search functionality
        document.querySelectorAll('.search-input').forEach(input => {
            input.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const panel = e.target.closest('.dependents-panel, .dependencies-panel');
                const cards = panel.querySelectorAll('.package-card');
                
                cards.forEach(card => {
                    const name = card.querySelector('.package-name').textContent.toLowerCase();
                    if (name.includes(searchTerm)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        });

        // Filter tag removal
        document.querySelectorAll('.tag-remove').forEach(btn => {
            btn.addEventListener('click', function() {
                this.parentElement.remove();
                // In real app, would update filter state
            });
        });

        // Action button handlers
        document.querySelectorAll('.action-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                console.log('Action clicked:', this.textContent);
            });
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                // Focus dependents panel
                document.querySelector('.dependents-panel .search-input').focus();
            } else if (e.key === 'ArrowRight') {
                // Focus dependencies panel
                document.querySelector('.dependencies-panel .search-input').focus();
            } else if (e.key === 'Escape') {
                // Clear search
                document.querySelectorAll('.search-input').forEach(input => {
                    input.value = '';
                    input.dispatchEvent(new Event('input'));
                });
            }
        });

        // Simulate real-time updates
        function updateStats() {
            const statValues = document.querySelectorAll('.stat-value');
            statValues.forEach(stat => {
                const current = parseInt(stat.textContent);
                const change = Math.random() > 0.5 ? 1 : -1;
                const newValue = Math.max(0, current + change);
                if (newValue !== current) {
                    stat.style.transform = 'scale(1.2)';
                    stat.textContent = newValue;
                    setTimeout(() => {
                        stat.style.transform = 'scale(1)';
                    }, 300);
                }
            });
        }

        // Update stats occasionally
        setInterval(updateStats, 10000);
    </script>
</body>
</html>